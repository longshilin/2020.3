<!DOCTYPE html><html class="no-js" lang="zh-cn">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
      new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
      })(window,document,'script','dataLayer','GTM-5V25JL6');
    </script><link href="https://fonts.googleapis.com/css?family=Roboto&amp;display=swap" rel="stylesheet">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="twitter:card" content="summary">
<meta property="og:title" content="构建和运行 WebGL 项目 - Unity 手册">
<title>构建和运行 WebGL 项目 - Unity 手册</title>
<meta property="og:image" content="https://docs.unity3d.com/cn/2020.3/uploads/Main/WebGLBuilding-BuildPlayerOptions.png">
<meta name="description" content="The Build folder contains the following files ([ExampleBuild] represents the name of the target build folder):">
<meta property="og:description" content="The Build folder contains the following files ([ExampleBuild] represents the name of the target build folder):">
<meta name="author" content="Unity Technologies">
<link rel="shortcut icon" href="https://unity.com/themes/contrib/unity_base/images/favicons/favicon.ico">
<link rel="icon" type="image/png" href="../StaticFiles/images/favicons/favicon.png">
<link rel="apple-touch-icon-precomposed" sizes="152x152" href="../StaticFiles/images/favicons/apple-touch-icon-152x152.png">
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="../StaticFiles/images/favicons/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon-precomposed" sizes="120x120" href="../StaticFiles/images/favicons/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="../StaticFiles/images/favicons/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="../StaticFiles/images/favicons/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon-precomposed" href="../StaticFiles/images/favicons/apple-touch-icon.png">
<meta name="msapplication-TileColor" content="#222c37">
<meta name="msapplication-TileImage" content="../StaticFiles/images/favicons/tileicon-144x144.png">
<script type="text/javascript" src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" charset="UTF-8" data-domain-script="6e91be4c-3145-4ea2-aa64-89d716064836"></script><script type="text/javascript">
        function OptanonWrapper() { }
    </script><script>
      var docs_type = 'Manual';
      var lang = 'cn';
      var page = 'webgl-building';
      if(!page) page = 'index';
      var version = '2020.3';
      var docs_versions = [{version: '2021.1',version_string: '2021.1',supported: true},{version: '2020.3',version_string: '2020.3',supported: true},{version: '2020.2',version_string: '2020.2',supported: false},{version: '2020.1',version_string: '2020.1',supported: false},{version: '2019.4',version_string: '2019.4',supported: true},{version: '2019.3',version_string: '2019.3',supported: false},{version: '2019.2',version_string: '2019.2',supported: false},{version: '2019.1',version_string: '2019.1',supported: false},{version: '2018.4',version_string: '2018.4',supported: true},{version: '2018.3',version_string: '2018.3',supported: false},{version: '2018.2',version_string: '2018.2',supported: false},{version: '2018.1',version_string: '2018.1',supported: false},{version: '2017.4',version_string: '2017.4',supported: false},{version: '2017.3',version_string: '2017.3',supported: false},{version: '2017.2',version_string: '2017.2',supported: false},{version: '2017.1',version_string: '2017.1',supported: false},{version: '5.6',version_string: '560',supported: false},];</script><script type="text/javascript" src="../StaticFiles/js/jquery.js"></script><script type="text/javascript" src="../StaticFiles/js/core.js"></script><script type="text/javascript" src="../StaticFiles/js/jquery.sidebar.min.js"></script><script type="text/javascript" src="docdata/toc.js"></script><script type="text/javascript" src=""></script><script type="text/javascript" src="../StaticFiles/js/custom.js"></script><link rel="stylesheet" type="text/css" href="../StaticFiles/css/core.css">
<link rel="stylesheet" type="text/css" href="../StaticFiles/css/custom.css">
<link rel="canonical" href="https://docs.unity3d.com/cn/2020.3/Manual/webgl-building.html">
<link rel="alternate" href="https://docs.unity3d.com/en/2020.3/Manual/webgl-building.html" hreflang="en">
<link rel="alternate" href="https://docs.unity3d.com/cn/2020.3/Manual/webgl-building.html" hreflang="zh">
<link rel="alternate" href="https://docs.unity3d.com/ja/2020.3/Manual/webgl-building.html" hreflang="ja">
<link rel="alternate" href="https://docs.unity3d.com/es/2020.3/Manual/webgl-building.html" hreflang="es">
<link rel="alternate" href="https://docs.unity3d.com/kr/2020.3/Manual/webgl-building.html" hreflang="ko">
<link rel="alternate" href="https://docs.unity3d.com/ru/2020.3/Manual/webgl-building.html" hreflang="ru">
<link rel="alternate" href="https://docs.unity3d.com/2020.3/Documentation/Manual/webgl-building.html" hreflang="x-default">
</head>
<body>
<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5V25JL6" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<div class="header-wrapper">
<div id="header" class="header"><div class="content">
<div class="spacer"><div class="menu">
<div id="nav-open" for="nav-input"><span></span></div>
<div class="logo"><a href="./index.html"></a></div>
<div class="search-form"><form action="30_search.html" method="get" class="apisearch">
<input type="text" name="q" placeholder="搜索手册..." autosave="Unity Reference" results="5" class="sbox field" id="q"><input type="submit" class="submit">
</form></div>
<ul class="menu-items">
<li class="menu-item"><a href="../Manual/index.html" class="selected">手册</a></li>
<li class="menu-item"><a href="../ScriptReference/index.html" class="">脚本 API</a></li>
</ul>
</div></div>
<div class="more">
<div class="filler"></div>
<ul><li><a href="https://unity3d.com/">
                unity3d.com
              </a></li></ul>
</div>
</div></div>
<div class="toolbar"><div class="content">
<div class="version-switcher">
<div class="current toggle" data-target=".version-list"><div class="version-number">
<div class="d-inline-block">
          Version:
          <b>2020.3</b>
</div>
<div class="d-inline-block arrow"></div>
</div></div>
<div class="version-list" style="display:none;">
<ul class="versions">
<li class="supported"><a class="docs_version_url_2021.1" href="/cn/2021.1/Manual/webgl-building.html">2021.1</a></li>
<li class="supported"><a class="docs_version_url_2020.3" href="/cn/2020.3/Manual/webgl-building.html">2020.3</a></li>
<li class=""><a class="docs_version_url_2020.2" href="/cn/2020.2/Manual/webgl-building.html">2020.2</a></li>
<li class=""><a class="docs_version_url_2020.1" href="/cn/2020.1/Manual/webgl-building.html">2020.1</a></li>
<li class="supported"><a class="docs_version_url_2019.4" href="/cn/2019.4/Manual/webgl-building.html">2019.4</a></li>
<li class=""><a class="docs_version_url_2019.3" href="/cn/2019.3/Manual/webgl-building.html">2019.3</a></li>
<li class=""><a class="docs_version_url_2019.2" href="/cn/2019.2/Manual/webgl-building.html">2019.2</a></li>
<li class=""><a class="docs_version_url_2019.1" href="/cn/2019.1/Manual/webgl-building.html">2019.1</a></li>
<li class="supported"><a class="docs_version_url_2018.4" href="/cn/2018.4/Manual/webgl-building.html">2018.4</a></li>
<li class=""><a class="docs_version_url_2018.3" href="/cn/2018.3/Manual/webgl-building.html">2018.3</a></li>
<li class=""><a class="docs_version_url_2018.2" href="/cn/2018.2/Manual/webgl-building.html">2018.2</a></li>
<li class=""><a class="docs_version_url_2018.1" href="/cn/2018.1/Manual/webgl-building.html">2018.1</a></li>
<li class=""><a class="docs_version_url_2017.4" href="/cn/2017.4/Manual/webgl-building.html">2017.4</a></li>
<li class=""><a class="docs_version_url_2017.3" href="/cn/2017.3/Manual/webgl-building.html">2017.3</a></li>
<li class=""><a class="docs_version_url_2017.2" href="/cn/2017.2/Manual/webgl-building.html">2017.2</a></li>
<li class=""><a class="docs_version_url_2017.1" href="/cn/2017.1/Manual/webgl-building.html">2017.1</a></li>
<li class=""><a class="docs_version_url_560" href="/cn/560/Manual/webgl-building.html">5.6</a></li>
<div class="versionsWithThisPage" style="display:none;"><li><p>包含此页的版本：</p></li></div>
<div class="versionsWithoutThisPage" style="display:none;"><li><p>不含此页的版本：</p></li></div>
</ul>
<ul class="description">
<li>
<div class="supported-box"></div>受支持</li>
<li>
<div class="legacy-box"></div>旧版</li>
</ul>
</div>
</div>
<ul class="nav-menu-items">
<li class="menu-item"><a href="../Manual/index.html" class="selected">手册</a></li>
<li class="menu-item"><a href="../ScriptReference/index.html" class="">脚本 API</a></li>
</ul>
<div class="lang-switcher">
<div class="current toggle" data-target=".lang-list">
<div class="lbl">语言:
        <span class="b">中文</span>
</div>
<div class="arrow"></div>
</div>
<div class="lang-list" style="display:none;"><ul>
<li><a data-lang="en" href="/2020.3/Documentation/Manual/webgl-building.html">English</a></li>
<li><a data-lang="cn" href="/cn/2020.3/Manual/webgl-building.html">中文</a></li>
<li><a data-lang="ja" href="/ja/2020.3/Manual/webgl-building.html">日本語</a></li>
<li><a data-lang="es" href="/es/2020.3/Manual/webgl-building.html">Español</a></li>
<li><a data-lang="kr" href="/kr/2020.3/Manual/webgl-building.html">한국어</a></li>
<li><a data-lang="ru" href="/ru/2020.3/Manual/webgl-building.html">Русский</a></li>
</ul></div>
</div>
</div></div>
</div>
<div id="master-wrapper" class="master-wrapper clear">
<div id="sidebar" class="sidebar hidden"><div class="sidebar-wrap"><div class="content"><div class="sidebar-menu"><div class="toc">
<h2>手册</h2>
<div class="version-switcher">
<div class="current toggle" data-target=".version-list"><div class="version-number">
<div class="d-inline-block">
          Version:
          <b>2020.3</b>
</div>
<div class="d-inline-block arrow"></div>
</div></div>
<div class="version-list" style="display:none;">
<ul class="versions">
<li class="supported"><a class="docs_version_url_2021.1" href="/cn/2021.1/Manual/webgl-building.html">2021.1</a></li>
<li class="supported"><a class="docs_version_url_2020.3" href="/cn/2020.3/Manual/webgl-building.html">2020.3</a></li>
<li class=""><a class="docs_version_url_2020.2" href="/cn/2020.2/Manual/webgl-building.html">2020.2</a></li>
<li class=""><a class="docs_version_url_2020.1" href="/cn/2020.1/Manual/webgl-building.html">2020.1</a></li>
<li class="supported"><a class="docs_version_url_2019.4" href="/cn/2019.4/Manual/webgl-building.html">2019.4</a></li>
<li class=""><a class="docs_version_url_2019.3" href="/cn/2019.3/Manual/webgl-building.html">2019.3</a></li>
<li class=""><a class="docs_version_url_2019.2" href="/cn/2019.2/Manual/webgl-building.html">2019.2</a></li>
<li class=""><a class="docs_version_url_2019.1" href="/cn/2019.1/Manual/webgl-building.html">2019.1</a></li>
<li class="supported"><a class="docs_version_url_2018.4" href="/cn/2018.4/Manual/webgl-building.html">2018.4</a></li>
<li class=""><a class="docs_version_url_2018.3" href="/cn/2018.3/Manual/webgl-building.html">2018.3</a></li>
<li class=""><a class="docs_version_url_2018.2" href="/cn/2018.2/Manual/webgl-building.html">2018.2</a></li>
<li class=""><a class="docs_version_url_2018.1" href="/cn/2018.1/Manual/webgl-building.html">2018.1</a></li>
<li class=""><a class="docs_version_url_2017.4" href="/cn/2017.4/Manual/webgl-building.html">2017.4</a></li>
<li class=""><a class="docs_version_url_2017.3" href="/cn/2017.3/Manual/webgl-building.html">2017.3</a></li>
<li class=""><a class="docs_version_url_2017.2" href="/cn/2017.2/Manual/webgl-building.html">2017.2</a></li>
<li class=""><a class="docs_version_url_2017.1" href="/cn/2017.1/Manual/webgl-building.html">2017.1</a></li>
<li class=""><a class="docs_version_url_560" href="/cn/560/Manual/webgl-building.html">5.6</a></li>
<div class="versionsWithThisPage" style="display:none;"><li><p>包含此页的版本：</p></li></div>
<div class="versionsWithoutThisPage" style="display:none;"><li><p>不含此页的版本：</p></li></div>
</ul>
<ul class="description">
<li>
<div class="supported-box"></div>受支持</li>
<li>
<div class="legacy-box"></div>旧版</li>
</ul>
</div>
</div>
<div class="clear"></div>
</div></div></div></div></div>
<div id="content-wrap" class="content-wrap opened-sidebar"><div class="content-block"><div class="content">
<div class="section">
<div class="breadcrumbs clear"><ul>
<li><a href="UnityManual.html">Unity User Manual 2020.3 (LTS)</a></li>
<li><a href="PlatformSpecific.html">平台开发</a></li>
<li><a href="webgl.html">WebGL</a></li>
<li><a href="webgl-gettingstarted.html">WebGL 开发入门</a></li>
<li>构建和运行 WebGL 项目</li>
</ul></div>
<div class="mb20"><div class="nextprev clear">
<div class="icon tt left mr1" data-distance="-40|-30|top">
<span class="prev"><a href="class-PlayerSettingsWebGL.html"></a></span><div class="tip">WebGL Player 设置</div>
</div>
<div class="icon tt right" data-distance="-40|-30|top">
<span class="next"><a href="webgl-deploying.html"></a></span><div class="tip">WebGL: Compressed builds and server configuration</div>
</div>
</div></div>
<h1>构建和运行 WebGL 项目</h1>
<!--BeginSwitchLink--><!--EndSwitchLink-->
<div class="clear"></div>

<p>The <code>Build</code> folder contains the following files (<code>[ExampleBuild]</code> represents the name of the target build folder):</p>

<table>
<colgroup>
<col style="text-align:left;">
<col style="text-align:left;">
</colgroup>

<thead>
<tr>
	<th style="text-align:left;">File name</th>
	<th style="text-align:left;">Contains</th>
</tr>
</thead>

<tbody>
<tr>
	<td style="text-align:left;"><code>[ExampleBuild].loader.js</code></td>
	<td style="text-align:left;">The JavaScript code that the web page needs in order to load the Unity content.</td>
</tr>
<tr>
	<td style="text-align:left;"><code>[ExampleBuild].framework.js</code></td>
	<td style="text-align:left;">JavaScript runtime and plugins.</td>
</tr>
<tr>
	<td style="text-align:left;"><code>[ExampleBuild].wasm</code></td>
	<td style="text-align:left;">WebAssembly binary.</td>
</tr>
<tr>
	<td style="text-align:left;"><code>[ExampleBuild].mem</code></td>
	<td style="text-align:left;">A binary image to initialize the heap memory for your Player. Unity only generates this file for multi-threaded WebAssembly builds.</td>
</tr>
<tr>
	<td style="text-align:left;"><code>[ExampleBuild].data</code></td>
	<td style="text-align:left;">Asset data and Scenes.</td>
</tr>
<tr>
	<td style="text-align:left;"><code>[ExampleBuild].symbols.json</code></td>
	<td style="text-align:left;">Debug symbol names necessary to demangle an error stack trace. This file is only generated for Release builds when you enable the Debug Symbols option (<strong>File</strong> &gt; <strong>Build Settings</strong> &gt; <strong>Player Settings</strong>.)</td>
</tr>
<tr>
	<td style="text-align:left;"><code>[ExampleBuild].jpg</code></td>
	<td style="text-align:left;">A background image, which displays while the build is loading. This file is only generated when a Background Image is provided in the Player Settings (<strong>File</strong> &gt; <strong>Build Settings</strong> &gt; <strong>Player Settings</strong> &gt; <strong>Splash Image</strong>). See the Splash Screen page for further information.</td>
</tr>
</tbody>
</table>

<p>If you enable a <strong>Compression Method</strong> for your build, Unity identifies the extension that corresponds with the compression method and adds this extension to the names of the files inside the Build subfolder. If you enable <strong>Decompression Fallback</strong>, Unity appends the extension <code>.unityweb</code> to the build file names. Otherwise, Unity appends the extension <code>.gz</code> for the Gzip compression method, or <code>.br</code> for the Brotli compression method.
For more information, see <a href="webgl-deploying.html">WebGL: Compressed builds and server configuration</a>.</p>

<p>If you enable <strong>Name Files As Hashes</strong> (in the <strong>Player Settings</strong>), Unity uses the hash of the file content instead of the default filename. This applies to each file in the build folder. This option allows you to upload updated versions of the game builds into the same folder on the server, and only upload the files which have changed between build iterations.</p>

<p>The best way to view the WebGL Player locally is to use Unity’s <strong>Build And Run</strong> option (menu: <strong>File</strong> &gt; <strong>Build And Run</strong>). Unity uses a local web server to host your build, and opens it from a localhost URL. Alternatively, you can use a custom local web server with properly configured response headers. For more information on setting up response headers, see <a href="webgl-deploying.html">WebGL: Compressed builds and server configuration</a>.</p>

<p><strong>Note</strong>: Opening a Player directly from the file system might not work in some browsers. This is due to security restrictions applied to local file URLs.</p>

<h2>Build Settings</h2>

<p>要访问 WebGL 构建设置，请打开 Build Settings 窗口 (<strong>File</strong> &gt; <strong>Build Settings</strong>)。然后，从 Platform 列表中选择 <strong>WebGL</strong>。</p>

<figure>
<img src="../uploads/Main/WebGLBuilding-BuildPlayerOptions.png" alt="Build Settings Window">
<figcaption>Build Settings Window</figcaption>
</figure>

<h3>Development Build</h3>

<p>选择 <strong>Development Build</strong> 设置时，Unity 会生成一个支持性能分析器的开发版和一个可供您查看应用程序中任何错误的开发控制台。此外，开发版不会缩减内容。开发版中的 JavaScript 是人类可读格式，而且 Unity 将保留函数名称，以便您可以查看错误的堆栈跟踪。但是，这意味着开发版将非常大，导致无法分发。
仅当启用了 Development Build 设置时，才能选择 <strong>Autoconnect Profiler</strong> 和 <strong>Deep Profiling Support</strong>。</p>

<h3>Autoconnect Profiler</h3>

<p>启用 <strong>Autoconnect Profiler</strong> 设置可分析 Unity WebGL 内容的性能。对于 WebGL，无法像在其他平台上那样将<a href="#Profiler">性能分析器</a>连接到正在运行的构建，因此必须使用此选项将内容连接到 Editor。这是因为性能分析器连接是使用 WebGL 上的 WebSockets 处理的，但 Web 浏览器仅允许来自内容的传出连接。</p>

<h3>Deep Profiling Support</h3>

<p>启用 <strong>Deep Profiling Support</strong> 设置可使 Unity Profiler 对应用程序中的每次函数调用都进行性能分析。如需了解更多信息，请参阅有关<a href="ProfilerWindow.html#deep-profiling">深度性能分析</a>的文档。</p>

<h2>播放器设置 (Player settings)</h2>

<p>WebGL 在 <a href="class-PlayerSettingsWebGL.html">Player 设置</a>（菜单：__Edit__ &gt; <strong>Project Settings__，然后选择 </strong>Player__ 类别）中有一些其他选项。</p>

<h3>Other Settings</h3>

<figure>
<img src="../uploads/Main/WebGLBuilding-OtherSettings.png" alt="">
</figure>

<h4>Strip Engine Code</h4>

<p>打开 <strong>Other Settings</strong> 访问 <strong>Strip Engine Code</strong> 选项。默认情况下会选中此选项以启用 WebGL 的代码剥离。选中此选项后，Unity 不会包含未使用的任何类的代码。例如，如果不使用任何物理组件或函数，则会从构建中删除整个物理引擎。有关更多详细信息，请参阅下面的“剥离”部分。</p>

<h3>Publishing Settings</h3>

<figure>
<img src="../uploads/Main/WebGLBuilding-PublishingSettings.png" alt="">
</figure>

<h4>Enable Exceptions</h4>

<p>打开 <strong>Publishing Settings</strong> 访问 <strong>Enable Exceptions</strong>。<strong>Enable Exceptions</strong> 允许指定在运行时如何处理意外的代码行为（通常视为错误）。该设置具有以下选项：</p>

<ul>
<li>__None__：如果不需要任何异常支持，请选择此选项。此选项可提供最佳性能和最小构建。使用此选项，抛出的任何异常都会导致内容因该设置中的错误而停止。</li>
<li>__Explicitly Thrown Exceptions Only__（默认设置）：选择此选项可捕获从脚本中的 <code>throw</code> 语句显式指定的异常，并可确保调用 <code>finally</code> 代码块。请注意，选择此选项会使脚本中生成的 JavaScript 代码变得更长且更慢；仅当脚本是项目的主要瓶颈时，这才会成为问题。</li>
<li>__Full Without Stacktrace__：选择此选项可捕获：

<ul>
<li>从脚本中的 <code>throw</code> 语句显式指定的异常（与 <em>Explicitly Thrown Exceptions Only</em> 选项一样）</li>
<li>Null 引用</li>
<li>越界数组访问</li>
</ul>
</li>
<li>__Full With Stacktrace__：此选项与上面的选项类似，但也捕获堆栈跟踪。Unity 通过在代码中嵌入对异常检查来生成这些异常，因此该选项会降低性能并增加浏览器内存使用量。仅用于调试，并始终在 64 位浏览器中进行测试。</li>
</ul>

<p>Select <strong>Publishing Settings</strong> to access <strong>Data Caching</strong>.</p>

<h2>Data Caching</h2>

<p>To access <strong>Data Caching</strong>, select <strong>Publishing Settings</strong> (<strong>File</strong> &gt; <strong>Build Settings</strong> &gt; <strong>Player Settings</strong> &gt; <strong>WebGL</strong> &gt; <strong>Publishing Settings</strong>). This enables the browser to cache the main data files into the IndexedDB database.</p>

<p>Using the default browser HTTP cache does not guarantee that the browser caches a particular response. This is because the browser HTTP cache has limited space, and the browser might not be able to cache files that are too large.</p>

<p>To improve your loading speed, IndexedDB allows you to cache files above the browser limit. When you cache more files, you increase the chance that downloaded content is available on the user’s machine during the next run of the build.</p>

<p>Data Caching only caches the <code>.data</code> files in the IndexedDB cache for HTTP responses. To cache AssetBundles, you need to enable Data Caching and override <code>unityInstance.Module.cacheControl()</code>.
To do this, make sure <code>Module.cacheControl(url)</code> returns <code>must-revalidate</code> for the requested AssetBundle URL. For example, you can override the unityInstance.Module.cacheControl() function in the fulfillment callback of the Promise that createUnityInstance() returns.
For further information on createUnityInstance() see <a href="webgl-deploying.html">WebGL: Compressed builds and server configuration</a>.</p>

<p>以 WebGL 为目标进行发布时，必须保持较低的构建大小，让用户在内容启动之前等待合理的下载时间，这一点很重要。有关减小资源大小的一般提示，请参阅<a href="ReducingFilesize.html">减小构建文件大小</a>相关文档。</p>

<h2>分发大小</h2>

<p>以 WebGL 为目标进行发布时，必须保持较低的构建大小，让用户在内容启动之前等待合理的下载时间，这一点很重要。有关减小资源大小的一般提示，请参阅<a href="ReducingFilesize.html">减小构建文件大小</a>相关文档。</p>

<h3>WebGL 特有的提示和技巧</h3>

<ul>
<li><p>在<a href="class-TextureImporter.html">纹理导入器 (Texture Importer)</a> 中为所有压缩纹理指定 <strong>Crunch</strong> 纹理压缩格式。</p></li>
<li><p>不要部署开发版本；它们不会经过压缩或<a href="https://en.wikipedia.org/wiki/Minification_%28programming%29">缩小</a>，因此文件大小要大得多。</p></li>
<li><p>打开 <strong>Player</strong> 设置（菜单：__Edit__ &gt; <strong>Project Settings__，然后选择 </strong>Player__ 类别），打开 <strong>Publishing Settings</strong> 面板，并将 <strong>Enable Exceptions</strong> 设置为 __None__（如果在构建中不需要异常）。</p></li>
<li><p>打开 <strong>Player</strong> 设置（菜单：__Edit__ &gt; <strong>Project Settings__，然后选择 </strong>Player__ 类别），打开 <strong>Other Settings</strong> 面板，然后启用 <strong>Strip Engine Code</strong> 以确保进行高效构建。</p></li>
<li><p>使用第三方托管的 dll 时要小心，因为它们可能包含大量依赖项，所以会显著增加生成的代码大小。</p></li>
</ul>

<p>如果要构建发布版本，Unity 将根据在 WebGL <strong>Player</strong> 设置的 <strong>Publishing Settings</strong> 面板中选择的 <strong>Compression Format</strong> 来压缩构建输出文件。</p>

<figure>
<img src="../uploads/Main/WebGLBuilding-CompressionFormat.png" alt="">
</figure>

<p>有关这些选项的更多信息以及如何使用它们发布构建，请参阅有关<a href="webgl-deploying.html">部署压缩构建</a>的文档。</p>

<h2>AssetBundle</h2>

<p>由于所有资源数据都需要在内容启动之前预先下载，因此应考虑将资源从主数据文件中移出到 <a href="AssetBundlesIntro.html">AssetBundle</a>中。这样，就能为内容创建一个小型加载场景，确保快速加载。然后，当用户继续浏览内容时，将按需动态加载资源。AssetBundle 还有助于进行<a href="webgl-memory.html">资源数据内存</a>管理：可通过调用 <a href="../ScriptReference/AssetBundle.Unload.html">AssetBundle.Unload</a> 从内存中卸载掉不再需要的资源的资源数据。</p>

<p>在 WebGL 平台上使用 AssetBundle 时的注意事项：</p>

<ul>
<li><p>在 AssetBundle 中使用未在主构建中使用的类类型时，Unity 可能会从构建中剥离这些类的代码。尝试从 AssetBundle 加载资源时，这可能会导致失败。请使用 <a href="../ScriptReference/BuildPlayerOptions-assetBundleManifestPath.html">BuildPlayerOptions.assetBundleManifestPath</a> 修复该问题，或参阅下面有关<em><a href="#Stripping">剥离</a></em>的部分以了解其他选项。</p></li>
<li><p>WebGL 不支持线程，但 http 下载内容仅在下载完成后才可用。因此，在下载完成时，Unity WebGL 构建需要在主线程上解压缩 AssetBundle 数据，而这会阻止主线程。为避免这种中断，<a href="AssetBundles-Building.html">LZMA AssetBundle 压缩</a>不可用于 WebGL 上的 AssetBundle。此情况下使用 LZ4 对 AssetBundle 进行压缩，这种压缩格式可非常高效地按需进行解压缩。如果所需的压缩大小比 LZ4 能够提供的压缩大小更小，可将 Web 服务器配置为对 AssetBundle 使用 gzip 或 Brotli 压缩（基于 LZ4 压缩）。请参阅有关<a href="webgl-deploying.html">部署压缩构建</a>的文档以详细了解如何执行此操作。</p></li>
<li><p>WebGL 支持通过 <a href="../ScriptReference/WWW.LoadFromCacheOrDownload.html">WWW.LoadFromCacheOrDownload</a> 对 AssetBundle 进行缓存，可使用来自浏览器的 IndexedDB API 在用户的计算机上实现缓存。请注意，IndexedDB 可能对某些浏览器提供的支持有限，并且浏览器可能会请求用户授权将数据存储在磁盘上。请参阅有关 <a href="webgl-browsercompatibility.html">WebGL 浏览器兼容性</a>的文档以了解更多信息。</p></li>
</ul>

<p><a name="Stripping"></a> </p>

<h2><strong>剥离</strong></h2>

<p>默认情况下，Unity 会从构建中删除所有未使用的代码。可通过 <strong>Player</strong> 设置（菜单：__Edit__ &gt; <strong>Project Settings__，然后选择 </strong>Player__ 类别）来更改此设置：选择 <strong>Other Settings</strong> 面板访问 <strong>Strip Engine Code</strong> 选项。最好在启用剥离的情况下进行构建。</p>

<p>启用代码剥离后，Unity 扫描会项目以查找是否使用了 <code>UnityObject</code> 派生的任何类（通过在脚本代码中或在场景中的序列化数据中引用）。然后从构建中删除所有未使用这些类的 Unity 子系统。这样可减少构建代码，从而减小下载和要解析的代码（因此代码运行速度更快，且占用的内存更少）。</p>

<h2>代码剥离的问题</h2>

<p>如果代码剥离时剥离了实际需要的代码，可能会导致项目出现问题。例如，如果在运行时加载的 AssetBundle 所包含的类未包括在主构建中，因此从项目中删除了这些 AssetBundle，这种情况下就可能出问题。发生这种情况时，浏览器的 JavaScript 控制台中会显示错误消息（随后可能会显示更多错误）。例如：</p>

<p><code>Could not produce class with ID XXX</code></p>

<p>To troubleshoot these errors, look up the ID (such as <code>XXX</code> in the example above) in the <a href="ClassIDReference.html">Class ID Reference</a> to see which class it is trying to create an instance of. In such cases, you can force Unity to include the code for that class in the build, either by adding a reference to that class to your scripts or to your Scenes, or by adding a <code>link.xml</code> file to your project. </p>

<p>Below is an example which makes sure that the Collider class (and therefore the Physics module) gets preserved in a project. Add this XML code to a file called <code>link.xml</code>, and put that file into your <em>Assets</em> folder.</p>

<pre><code>&lt;linker&gt;
    &lt;assembly fullname="UnityEngine"&gt;
        &lt;type fullname="UnityEngine.Collider" preserve="all"/&gt;
    &lt;/assembly&gt;
&lt;/linker&gt;

</code></pre>

<p>如果怀疑剥离导致构建出现问题，还可尝试在测试期间禁用 <strong>Strip Engine Code</strong> 选项。</p>

<p>Unity does not provide a convenient way to see which modules and classes are included in a build, which would allow you to optimize your project to strip well. However, to get an overview of included classes and modules, you can look at the generated file <code>Temp/StagingArea/Data/il2cppOutput/UnityClassRegistration.cpp</code> after making a build.</p>

<p>Note that the <strong>Strip Engine Code</strong> option only affects Unity engine code. IL2CPP always strips byte code from your managed dlls and scripts. This can cause problems when you need to reference managed types dynamically through reflection rather than through static references in your code. If you need to access types through reflection, you may also need to set up a <code>link.xml</code> file to preserve those types. See the documentation page on <a href="iphone-playerSizeOptimization.html">iOS Build size optimization</a> for more information on <code>link.xml</code> files.</p>

<h2>移动构建输出文件</h2>

<p>To change the location of your <code>Build</code> folder, modify the buildUrl variable in the WebGL Template index.html file.</p>

<p>To change the location of the files inside the <code>Build</code> folder, change their URLs (that is, <code>dataUrl</code>, <code>wasmCodeUrl</code>, <code>wasmMemoryUrl</code>, and <code>wasmFrameworkUrl</code>) in the parameters to the config variable in the index.html file.</p>

<p>You can specify URLs on external servers for these if you want to host your files on a content distribution network (CDN), but you need to make sure that the hosting server has enabled Cross Origin Resource Sharing (CORS) for this to work. See the manual page on <a href="webgl-networking.html">WebGL networking</a> for more information about CORS.</p>

<h2>增量构建</h2>

<p>The C++ code generated for your project by IL2CPP is compiled incrementally; that is, only generated C++ code that has changed since the last build is compiled again. Unchanged source code re-uses the same object files generated for the previous build. The object files used for incremental C++ builds are stored in the <code>Library/il2cpp_cache</code> directory in your Unity project. </p>

<p>To perform a clean, from-scratch build of the generated C++ code which doesn’t use incremental compiling, delete the <code>Library/il2cpp_cache</code> directory in your Unity project. Note that if the Unity Editor version differs from the one used for the previous WebGL build, Unity does a clean, from-scratch build automatically.</p>

<hr>

<ul>
<li><span class="page-history">在 Unity 2017.3 中添加了 Full Without Stacktrace</span></li>
<li><span class="page-history">在 Unity 2019.1 中删除了 asm.js 链接器目标</span></li>
<li><span class="page-history">Build file updates and Data Caching added in Unity 2020.1</span></li>
</ul>
<!-- area:platforms -->
<div class="nextprev clear">
<div class="icon tt left mr1" data-distance="-40|-30|top">
<span class="prev"><a href="class-PlayerSettingsWebGL.html"></a></span><div class="tip">WebGL Player 设置</div>
</div>
<div class="icon tt right" data-distance="-40|-30|top">
<span class="next"><a href="webgl-deploying.html"></a></span><div class="tip">WebGL: Compressed builds and server configuration</div>
</div>
</div>
</div>
<div class="footer-wrapper">
<div class="footer clear">
<div class="copy">版权所有 © 2020 Unity Technologies. Publication 2020.3</div>
<div class="menu">
<a href="https://learn.unity.com/">教程</a><a href="https://answers.unity3d.com">社区答案</a><a href="https://support.unity3d.com/hc/en-us">知识库</a><a href="https://forum.unity3d.com">论坛</a><a href="https://unity3d.com/asset-store">Asset Store</a>
</div>
</div>
<div></div>
</div>
</div></div></div>
</div>
</body>
</html>
