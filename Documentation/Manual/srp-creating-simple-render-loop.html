<!DOCTYPE html><html class="no-js" lang="zh-cn">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
      new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
      })(window,document,'script','dataLayer','GTM-5V25JL6');
    </script><link href="https://fonts.googleapis.com/css?family=Roboto&amp;display=swap" rel="stylesheet">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="twitter:card" content="summary">
<meta property="og:title" content="Creating a simple render loop in a custom render pipeline - Unity 手册">
<title>Creating a simple render loop in a custom render pipeline - Unity 手册</title>
<meta name="description" content="A render loop is the term for all of the rendering operations that take place in a single frame. This page contains information on creating a simple render loop in a custom render pipeline that is based on Unity&amp;#8217;s Scriptable Render Pipeline.">
<meta property="og:description" content="A render loop is the term for all of the rendering operations that take place in a single frame. This page contains information on creating a simple render loop in a custom render pipeline that is based on Unity&amp;#8217;s Scriptable Render Pipeline.">
<meta name="author" content="Unity Technologies">
<link rel="shortcut icon" href="https://unity.com/themes/contrib/unity_base/images/favicons/favicon.ico">
<link rel="icon" type="image/png" href="../StaticFiles/images/favicons/favicon.png">
<link rel="apple-touch-icon-precomposed" sizes="152x152" href="../StaticFiles/images/favicons/apple-touch-icon-152x152.png">
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="../StaticFiles/images/favicons/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon-precomposed" sizes="120x120" href="../StaticFiles/images/favicons/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="../StaticFiles/images/favicons/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="../StaticFiles/images/favicons/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon-precomposed" href="../StaticFiles/images/favicons/apple-touch-icon.png">
<meta name="msapplication-TileColor" content="#222c37">
<meta name="msapplication-TileImage" content="../StaticFiles/images/favicons/tileicon-144x144.png">
<script type="text/javascript" src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" charset="UTF-8" data-domain-script="6e91be4c-3145-4ea2-aa64-89d716064836"></script><script type="text/javascript">
        function OptanonWrapper() { }
    </script><script>
      var docs_type = 'Manual';
      var lang = 'cn';
      var page = 'srp-creating-simple-render-loop';
      if(!page) page = 'index';
      var version = '2020.3';
      var docs_versions = [{version: '2021.1',version_string: '2021.1',supported: true},{version: '2020.3',version_string: '2020.3',supported: true},{version: '2020.2',version_string: '2020.2',supported: false},{version: '2020.1',version_string: '2020.1',supported: false},{version: '2019.4',version_string: '2019.4',supported: true},{version: '2019.3',version_string: '2019.3',supported: false},{version: '2019.2',version_string: '2019.2',supported: false},{version: '2019.1',version_string: '2019.1',supported: false},{version: '2018.4',version_string: '2018.4',supported: true},{version: '2018.3',version_string: '2018.3',supported: false},{version: '2018.2',version_string: '2018.2',supported: false},{version: '2018.1',version_string: '2018.1',supported: false},{version: '2017.4',version_string: '2017.4',supported: false},{version: '2017.3',version_string: '2017.3',supported: false},{version: '2017.2',version_string: '2017.2',supported: false},{version: '2017.1',version_string: '2017.1',supported: false},{version: '5.6',version_string: '560',supported: false},];</script><script type="text/javascript" src="../StaticFiles/js/jquery.js"></script><script type="text/javascript" src="../StaticFiles/js/core.js"></script><script type="text/javascript" src="../StaticFiles/js/jquery.sidebar.min.js"></script><script type="text/javascript" src="docdata/toc.js"></script><script type="text/javascript" src=""></script><script type="text/javascript" src="../StaticFiles/js/custom.js"></script><link rel="stylesheet" type="text/css" href="../StaticFiles/css/core.css">
<link rel="stylesheet" type="text/css" href="../StaticFiles/css/custom.css">
<link rel="canonical" href="https://docs.unity3d.com/cn/2020.3/Manual/srp-creating-simple-render-loop.html">
<link rel="alternate" href="https://docs.unity3d.com/en/2020.3/Manual/srp-creating-simple-render-loop.html" hreflang="en">
<link rel="alternate" href="https://docs.unity3d.com/cn/2020.3/Manual/srp-creating-simple-render-loop.html" hreflang="zh">
<link rel="alternate" href="https://docs.unity3d.com/ja/2020.3/Manual/srp-creating-simple-render-loop.html" hreflang="ja">
<link rel="alternate" href="https://docs.unity3d.com/es/2020.3/Manual/srp-creating-simple-render-loop.html" hreflang="es">
<link rel="alternate" href="https://docs.unity3d.com/kr/2020.3/Manual/srp-creating-simple-render-loop.html" hreflang="ko">
<link rel="alternate" href="https://docs.unity3d.com/ru/2020.3/Manual/srp-creating-simple-render-loop.html" hreflang="ru">
<link rel="alternate" href="https://docs.unity3d.com/2020.3/Documentation/Manual/srp-creating-simple-render-loop.html" hreflang="x-default">
</head>
<body>
<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5V25JL6" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<div class="header-wrapper">
<div id="header" class="header"><div class="content">
<div class="spacer"><div class="menu">
<div id="nav-open" for="nav-input"><span></span></div>
<div class="logo"><a href="./index.html"></a></div>
<div class="search-form"><form action="30_search.html" method="get" class="apisearch">
<input type="text" name="q" placeholder="搜索手册..." autosave="Unity Reference" results="5" class="sbox field" id="q"><input type="submit" class="submit">
</form></div>
<ul class="menu-items">
<li class="menu-item"><a href="../Manual/index.html" class="selected">手册</a></li>
<li class="menu-item"><a href="../ScriptReference/index.html" class="">脚本 API</a></li>
</ul>
</div></div>
<div class="more">
<div class="filler"></div>
<ul><li><a href="https://unity3d.com/">
                unity3d.com
              </a></li></ul>
</div>
</div></div>
<div class="toolbar"><div class="content">
<div class="version-switcher">
<div class="current toggle" data-target=".version-list"><div class="version-number">
<div class="d-inline-block">
          Version:
          <b>2020.3</b>
</div>
<div class="d-inline-block arrow"></div>
</div></div>
<div class="version-list" style="display:none;">
<ul class="versions">
<li class="supported"><a class="docs_version_url_2021.1" href="/cn/2021.1/Manual/srp-creating-simple-render-loop.html">2021.1</a></li>
<li class="supported"><a class="docs_version_url_2020.3" href="/cn/2020.3/Manual/srp-creating-simple-render-loop.html">2020.3</a></li>
<li class=""><a class="docs_version_url_2020.2" href="/cn/2020.2/Manual/srp-creating-simple-render-loop.html">2020.2</a></li>
<li class=""><a class="docs_version_url_2020.1" href="/cn/2020.1/Manual/srp-creating-simple-render-loop.html">2020.1</a></li>
<li class="supported"><a class="docs_version_url_2019.4" href="/cn/2019.4/Manual/srp-creating-simple-render-loop.html">2019.4</a></li>
<li class=""><a class="docs_version_url_2019.3" href="/cn/2019.3/Manual/srp-creating-simple-render-loop.html">2019.3</a></li>
<li class=""><a class="docs_version_url_2019.2" href="/cn/2019.2/Manual/srp-creating-simple-render-loop.html">2019.2</a></li>
<li class=""><a class="docs_version_url_2019.1" href="/cn/2019.1/Manual/srp-creating-simple-render-loop.html">2019.1</a></li>
<li class="supported"><a class="docs_version_url_2018.4" href="/cn/2018.4/Manual/srp-creating-simple-render-loop.html">2018.4</a></li>
<li class=""><a class="docs_version_url_2018.3" href="/cn/2018.3/Manual/srp-creating-simple-render-loop.html">2018.3</a></li>
<li class=""><a class="docs_version_url_2018.2" href="/cn/2018.2/Manual/srp-creating-simple-render-loop.html">2018.2</a></li>
<li class=""><a class="docs_version_url_2018.1" href="/cn/2018.1/Manual/srp-creating-simple-render-loop.html">2018.1</a></li>
<li class=""><a class="docs_version_url_2017.4" href="/cn/2017.4/Manual/srp-creating-simple-render-loop.html">2017.4</a></li>
<li class=""><a class="docs_version_url_2017.3" href="/cn/2017.3/Manual/srp-creating-simple-render-loop.html">2017.3</a></li>
<li class=""><a class="docs_version_url_2017.2" href="/cn/2017.2/Manual/srp-creating-simple-render-loop.html">2017.2</a></li>
<li class=""><a class="docs_version_url_2017.1" href="/cn/2017.1/Manual/srp-creating-simple-render-loop.html">2017.1</a></li>
<li class=""><a class="docs_version_url_560" href="/cn/560/Manual/srp-creating-simple-render-loop.html">5.6</a></li>
<div class="versionsWithThisPage" style="display:none;"><li><p>包含此页的版本：</p></li></div>
<div class="versionsWithoutThisPage" style="display:none;"><li><p>不含此页的版本：</p></li></div>
</ul>
<ul class="description">
<li>
<div class="supported-box"></div>受支持</li>
<li>
<div class="legacy-box"></div>旧版</li>
</ul>
</div>
</div>
<ul class="nav-menu-items">
<li class="menu-item"><a href="../Manual/index.html" class="selected">手册</a></li>
<li class="menu-item"><a href="../ScriptReference/index.html" class="">脚本 API</a></li>
</ul>
<div class="lang-switcher">
<div class="current toggle" data-target=".lang-list">
<div class="lbl">语言:
        <span class="b">中文</span>
</div>
<div class="arrow"></div>
</div>
<div class="lang-list" style="display:none;"><ul>
<li><a data-lang="en" href="/2020.3/Documentation/Manual/srp-creating-simple-render-loop.html">English</a></li>
<li><a data-lang="cn" href="/cn/2020.3/Manual/srp-creating-simple-render-loop.html">中文</a></li>
<li><a data-lang="ja" href="/ja/2020.3/Manual/srp-creating-simple-render-loop.html">日本語</a></li>
<li><a data-lang="es" href="/es/2020.3/Manual/srp-creating-simple-render-loop.html">Español</a></li>
<li><a data-lang="kr" href="/kr/2020.3/Manual/srp-creating-simple-render-loop.html">한국어</a></li>
<li><a data-lang="ru" href="/ru/2020.3/Manual/srp-creating-simple-render-loop.html">Русский</a></li>
</ul></div>
</div>
</div></div>
</div>
<div id="master-wrapper" class="master-wrapper clear">
<div id="sidebar" class="sidebar hidden"><div class="sidebar-wrap"><div class="content"><div class="sidebar-menu"><div class="toc">
<h2>手册</h2>
<div class="version-switcher">
<div class="current toggle" data-target=".version-list"><div class="version-number">
<div class="d-inline-block">
          Version:
          <b>2020.3</b>
</div>
<div class="d-inline-block arrow"></div>
</div></div>
<div class="version-list" style="display:none;">
<ul class="versions">
<li class="supported"><a class="docs_version_url_2021.1" href="/cn/2021.1/Manual/srp-creating-simple-render-loop.html">2021.1</a></li>
<li class="supported"><a class="docs_version_url_2020.3" href="/cn/2020.3/Manual/srp-creating-simple-render-loop.html">2020.3</a></li>
<li class=""><a class="docs_version_url_2020.2" href="/cn/2020.2/Manual/srp-creating-simple-render-loop.html">2020.2</a></li>
<li class=""><a class="docs_version_url_2020.1" href="/cn/2020.1/Manual/srp-creating-simple-render-loop.html">2020.1</a></li>
<li class="supported"><a class="docs_version_url_2019.4" href="/cn/2019.4/Manual/srp-creating-simple-render-loop.html">2019.4</a></li>
<li class=""><a class="docs_version_url_2019.3" href="/cn/2019.3/Manual/srp-creating-simple-render-loop.html">2019.3</a></li>
<li class=""><a class="docs_version_url_2019.2" href="/cn/2019.2/Manual/srp-creating-simple-render-loop.html">2019.2</a></li>
<li class=""><a class="docs_version_url_2019.1" href="/cn/2019.1/Manual/srp-creating-simple-render-loop.html">2019.1</a></li>
<li class="supported"><a class="docs_version_url_2018.4" href="/cn/2018.4/Manual/srp-creating-simple-render-loop.html">2018.4</a></li>
<li class=""><a class="docs_version_url_2018.3" href="/cn/2018.3/Manual/srp-creating-simple-render-loop.html">2018.3</a></li>
<li class=""><a class="docs_version_url_2018.2" href="/cn/2018.2/Manual/srp-creating-simple-render-loop.html">2018.2</a></li>
<li class=""><a class="docs_version_url_2018.1" href="/cn/2018.1/Manual/srp-creating-simple-render-loop.html">2018.1</a></li>
<li class=""><a class="docs_version_url_2017.4" href="/cn/2017.4/Manual/srp-creating-simple-render-loop.html">2017.4</a></li>
<li class=""><a class="docs_version_url_2017.3" href="/cn/2017.3/Manual/srp-creating-simple-render-loop.html">2017.3</a></li>
<li class=""><a class="docs_version_url_2017.2" href="/cn/2017.2/Manual/srp-creating-simple-render-loop.html">2017.2</a></li>
<li class=""><a class="docs_version_url_2017.1" href="/cn/2017.1/Manual/srp-creating-simple-render-loop.html">2017.1</a></li>
<li class=""><a class="docs_version_url_560" href="/cn/560/Manual/srp-creating-simple-render-loop.html">5.6</a></li>
<div class="versionsWithThisPage" style="display:none;"><li><p>包含此页的版本：</p></li></div>
<div class="versionsWithoutThisPage" style="display:none;"><li><p>不含此页的版本：</p></li></div>
</ul>
<ul class="description">
<li>
<div class="supported-box"></div>受支持</li>
<li>
<div class="legacy-box"></div>旧版</li>
</ul>
</div>
</div>
<div class="clear"></div>
</div></div></div></div></div>
<div id="content-wrap" class="content-wrap opened-sidebar"><div class="content-block"><div class="content">
<div class="section">
<div class="breadcrumbs clear"><ul>
<li><a href="UnityManual.html">Unity User Manual 2020.3 (LTS)</a></li>
<li><a href="Graphics.html">图形</a></li>
<li><a href="render-pipelines.html">渲染管线</a></li>
<li><a href="srp-custom.html">Creating a custom render pipeline</a></li>
<li>Creating a simple render loop in a custom render pipeline</li>
</ul></div>
<div class="mb20"><div class="nextprev clear">
<div class="icon tt left mr1" data-distance="-40|-30|top">
<span class="prev"><a href="srp-creating-render-pipeline-asset-and-render-pipeline-instance.html"></a></span><div class="tip">Creating a Render Pipeline Asset and Render Pipeline Instance in a custom render pipeline</div>
</div>
<div class="icon tt right" data-distance="-40|-30|top">
<span class="next"><a href="CamerasOverview.html"></a></span><div class="tip">Cameras</div>
</div>
</div></div>
<h1>Creating a simple render loop in a custom render pipeline</h1>
<!--BeginSwitchLink--><!--EndSwitchLink-->
<div class="clear"></div>

<p>A render loop is the term for all of the rendering operations that take place in a single frame. This page contains information on creating a simple render loop in a custom render pipeline that is based on Unity’s Scriptable Render Pipeline.</p>

<p>The code examples on this page demonstrate the basic principles of using the Scriptable Render Pipeline. You can use this information to build your own custom Scriptable Render Pipeline, or to understand how Unity’s prebuilt Scriptable Render Pipelines work. </p>

<h2>Preparing your project</h2>

<p>Before you begin writing the code for your render loop, you must prepare your project.</p>

<p>The steps are as follows:</p>

<ol>
<li>
<a href="#creating-unity-shader">Create an SRP-compatible Unity shader</a>.</li>
<li>
<a href="#creating-gameobject">Create one or more GameObjects to render</a>.</li>
<li>
<a href="#creating-srp">Create the basic structure of your custom SRP</a>.</li>
<li>
<em>Optional:</em> If you plan to extend your simple custom SRP to add more complex functionality, install the SRP Core package. The SRP Core package includes the SRP Core shader library (which you can use to make your Unity shaders SRP Batcher compatible), and utility functions for common operations. For more information, see the <a href="https://docs.unity3d.com/Packages/com.unity.render-pipelines.core@latest">SRP Core package documentation</a>.</li>
</ol>

<p><a name="creating-unity-shader"></a></p>

<h3>Creating an SRP-compatible Unity shader</h3>

<p>In the Scriptable Render Pipeline, you use the LightMode Pass tag in a Unity shader to determine how to draw geometry. For more information on assigning Pass tags to Unity shaders, see <a href="SL-PassTags.html">ShaderLab: assigning tags to a Pass</a>.</p>

<p>This task shows you how to create a very simple unlit Unity shader with a LightMode Pass tag value of <code>ExampleLightModeTag</code>.</p>

<ol>
<li>Create a new Unity shader asset in your project. For instructions on creating a Unity shader asset, see <a href="class-Shader.html">Unity shader assets</a>.</li>
<li>In your Project view, double click the Unity shader asset to open the Unity shader source code in a text editor.</li>
<li>Replace the existing shader code with the following:</li>
</ol>

<pre><code>// This is a simple unlit Unity shader that is compatible with a custom Scriptable Render Pipeline.
// It applies a hardcoded color, and demonstrates the use of the LightMode Pass tag.
// It is not compatible with SRP Batcher.

Shader "Examples/SimpleUnlitColor"
{
    SubShader
    {
        Pass
        {
            // The value of the LightMode Pass tag must match the ShaderTagId in ScriptableRenderContext.DrawRenderers
            Tags { "LightMode" = "ExampleLightModeTag"}

            HLSLPROGRAM
            #pragma vertex vert
            #pragma fragment frag

    float4x4 unity_MatrixVP;
            float4x4 unity_ObjectToWorld;

            struct Attributes
            {
                float4 positionOS   : POSITION;
            };

            struct Varyings
            {
                float4 positionCS : SV_POSITION;
            };

            Varyings vert (Attributes IN)
            {
                Varyings OUT;
                float4 worldPos = mul(unity_ObjectToWorld, IN.positionOS);
                OUT.positionCS = mul(unity_MatrixVP, worldPos);
                return OUT;
            }

            float4 frag (Varyings IN) : SV_TARGET
            {
                return float4(0.5,1,0.5,1);
            }
            ENDHLSL
        }
    }
}
</code></pre>

<p><a name="creating-gameobject"></a></p>

<h3>Creating a GameObject to render</h3>

<p>In order to test that your render loop works, you must create something to render. This task shows you how to put GameObjects in your scene that use the SRP-compatible Unity shader that you created in the previous task.</p>

<ol>
<li>Create a new material asset in your Unity project. For instructions on creating a material asset, see <a href="class-Material.html">Materials</a>.</li>
<li>Assign the Unity shader to the material asset. For instructions on assigning a Unity shader to a material asset, see <a href="class-Material.html">Materials</a>.</li>
<li>Create a cube in your scene. For instructions on creating a cube in your scene, see <a href="PrimitiveObjects.html">Primitive objects</a>.</li>
<li>Assign the material to it. For instructions on assigning a material to a GameObject, see <a href="class-Material.html">Materials</a>.</li>
</ol>

<p><a name="creating-srp"></a></p>

<h3>Creating the basic structure of your custom SRP</h3>

<p>The final stage of preparation is to create the basic source files needed for your custom SRP, and tell Unity to begin rendering using the custom SRP.</p>

<ol>
<li>Create a class that inherits from <code>RenderPipeline</code> and a compatible Render Pipeline Asset, following the instructions in <a href="srp-creating-render-pipeline-asset-and-render-pipeline-instance.html">Creating a Render Pipeline Instance and Render Pipeline Asset</a>
</li>
<li>Set the active Render Pipeline Asset, following the instructions in <a href="srp-setting-render-pipeline-asset.html">Setting the active Render Pipeline Asset</a>. Unity will begin rendering using the custom SRP immediately, which means that your Scene view and Game view will be blank until you add code to your custom SRP.</li>
</ol>

<h2>Creating the render loop</h2>

<p>In a simple render loop, the basic operations are:</p>

<ul>
<li>
<a href="#clearing">Clearing the render target</a>, which means removing the geometry that was drawn during the last frame.</li>
<li>
<a href="#culling">Culling</a>, which means filtering out geometry that is not visible to a Camera.</li>
<li>
<a href="#drawing">Drawing</a>, which means telling the GPU what geometry to draw, and how to draw it.</li>
</ul>

<p><a name="clearing"></a></p>

<h3>Clearing the render target</h3>

<p>Clearing means removing the things that were drawn during the last frame. The render target is usually the screen; however, you can also render to textures to create a “picture in picture” effect. These examples demonstrate how to render to the screen, which is Unity’s default behavior.</p>

<p>To clear the render target in the Scriptable Render Pipeline, you do the following:</p>

<ol>
<li>Configure a <code>CommandBuffer</code> with a <code>Clear</code> command.</li>
<li>Add the <code>CommandBuffer</code> to the queue of commands on the <code>ScriptableRenderContext</code>; to do this, call <a href="../ScriptReference/Rendering.ScriptableRenderContext.ExecuteCommandBuffer.html">ScriptableRenderContext.ExecuteCommandBuffer</a>.</li>
<li>Instruct the graphics API to perform the queue of commands on the <code>ScriptableRenderContext</code>; to do this, call <a href="../ScriptReference/Rendering.ScriptableRenderContext.Submit.html">ScriptableRenderContext.Submit</a>.</li>
</ol>

<p>As with all Scriptable Render Pipeline operations, you use the <a href="../ScriptReference/Rendering.RenderPipeline.Render.html">RenderPipeline.Render</a> method as the entry point for this code. This example code demonstrates how to do this:</p>

<pre><code class="c#">/* 
This is a simplified example of a custom Scriptable Render Pipeline.
It demonstrates how a basic render loop works.
It shows the clearest workflow, rather than the most efficient runtime performance.
*/

using UnityEngine;
using UnityEngine.Rendering;

public class ExampleRenderPipeline : RenderPipeline {
    public ExampleRenderPipeline() {
    }

    protected override void Render (ScriptableRenderContext context, Camera[] cameras) {
        // Create and schedule a command to clear the current render target
        var cmd = new CommandBuffer();
        cmd.ClearRenderTarget(true, true, Color.black);
        context.ExecuteCommandBuffer(cmd);
        cmd.Release();

        // Instruct the graphics API to perform all scheduled commands
        context.Submit();
    }
}
</code></pre>

<p><a name="culling"></a></p>

<h3>Culling</h3>

<p>Culling is the process of filtering out geometry that is not visible to a Camera.</p>

<p>To cull in the Scriptable Render Pipeline, you do the following:</p>

<ol>
<li>Populate a <a href="../ScriptReference/Rendering.ScriptableCullingParameters.html">ScriptableCullingParameters</a> struct with data about a Camera; to do this, call <a href="../ScriptReference/Camera.TryGetCullingParameters.html">Camera.TryGetCullingParameters</a>.</li>
<li>Optional: Manually update the values of the <code>ScriptableCullingParameters</code> struct.</li>
<li>Call <a href="../ScriptReference/Rendering.ScriptableRenderContext.Cull.html">ScriptableRenderContext.Cull</a>, and store the results in a <code>CullingResults</code> struct.</li>
</ol>

<p>This example code extends the example above, and demonstrates how to clear the render target and then perform a culling operation:</p>

<pre><code class="c#">/* 
This is a simplified example of a custom Scriptable Render Pipeline.
It demonstrates how a basic render loop works.
It shows the clearest workflow, rather than the most efficient runtime performance.
*/

using UnityEngine;
using UnityEngine.Rendering;

public class ExampleRenderPipeline : RenderPipeline {
    public ExampleRenderPipeline() {
    }

    protected override void Render (ScriptableRenderContext context, Camera[] cameras) {
        // Create and schedule a command to clear the current render target
        var cmd = new CommandBuffer();
        cmd.ClearRenderTarget(true, true, Color.black);
        context.ExecuteCommandBuffer(cmd);
        cmd.Release();

        // Iterate over all Cameras
        foreach (Camera camera in cameras)
        {
            // Get the culling parameters from the current Camera
            camera.TryGetCullingParameters(out var cullingParameters);

            // Use the culling parameters to perform a cull operation, and store the results
            var cullingResults = context.Cull(ref cullingParameters);
        }

        // Instruct the graphics API to perform all scheduled commands
        context.Submit();
    }
}
</code></pre>

<p><a name="drawing"></a></p>

<h3>Drawing</h3>

<p>Drawing is the process of instructing the graphics API to draw a given set of geometry with given settings.</p>

<p>To draw in SRP, you do the following:</p>

<ol>
<li>Perform a culling operation, as described above, and store the results in a <code>CullingResults</code> struct.</li>
<li>Create and configure <a href="../ScriptReference/Rendering.FilteringSettings.html">FilteringSettings</a> struct, which describes how to filter the culling results.</li>
<li>Create and configure a <a href="../ScriptReference/DrawingSettings.html">DrawingSettings</a> struct, which describes which geometry to draw and how to draw it.</li>
<li>
<em>Optional</em>: By default, Unity sets the render state based on the Unity shader. If you want to override the render state for some or all of the geometry that you are about to draw, you can use a <a href="../ScriptReference/Rendering.RenderStateBlock.html">RenderStateBlock</a> struct to do this.</li>
<li>Call <a href="../ScriptReference/Rendering.ScriptableRenderContext.DrawRenderers.html">ScriptableRenderContext.DrawRenderers</a>, and pass the structs that you created as parameters. Unity draws the filtered set of geometry, according to the settings.</li>
</ol>

<p>This example code builds on the examples above, and demonstrates how to clear the render target, perform a culling operation, and draw the resulting geometry:</p>

<pre><code class="c#">/* 
This is a simplified example of a custom Scriptable Render Pipeline.
It demonstrates how a basic render loop works.
It shows the clearest workflow, rather than the most efficient runtime performance.
*/

using UnityEngine;
using UnityEngine.Rendering;

public class ExampleRenderPipeline : RenderPipeline {
    public ExampleRenderPipeline() {
    }

    protected override void Render (ScriptableRenderContext context, Camera[] cameras) {
        // Create and schedule a command to clear the current render target
        var cmd = new CommandBuffer();
        cmd.ClearRenderTarget(true, true, Color.black);
        context.ExecuteCommandBuffer(cmd);
        cmd.Release();

        // Iterate over all Cameras
        foreach (Camera camera in cameras)
        {
            // Get the culling parameters from the current Camera
            camera.TryGetCullingParameters(out var cullingParameters);

            // Use the culling parameters to perform a cull operation, and store the results
            var cullingResults = context.Cull(ref cullingParameters);

            // Update the value of built-in shader variables, based on the current Camera
            context.SetupCameraProperties(camera);

            // Tell Unity which geometry to draw, based on its LightMode Pass tag value
            ShaderTagId shaderTagId = new ShaderTagId("ExampleLightModeTag");

            // Tell Unity how to sort the geometry, based on the current Camera
            var sortingSettings = new SortingSettings(camera);

            // Create a DrawingSettings struct that describes which geometry to draw and how to draw it
            DrawingSettings drawingSettings = new DrawingSettings(shaderTagId, sortingSettings);

            // Tell Unity how to filter the culling results, to further specify which geometry to draw
            // Use FilteringSettings.defaultValue to specify no filtering
            FilteringSettings filteringSettings = FilteringSettings.defaultValue;
        
            // Schedule a command to draw the geometry, based on the settings you have defined
            context.DrawRenderers(cullingResults, ref drawingSettings, ref filteringSettings);

            // Schedule a command to draw the Skybox if required
            if (camera.clearFlags == CameraClearFlags.Skybox &amp;&amp; RenderSettings.skybox != null)
            {
                context.DrawSkybox(camera);
            }

            // Instruct the graphics API to perform all scheduled commands
            context.Submit();
        }
    }
}
</code></pre>
<div class="nextprev clear">
<div class="icon tt left mr1" data-distance="-40|-30|top">
<span class="prev"><a href="srp-creating-render-pipeline-asset-and-render-pipeline-instance.html"></a></span><div class="tip">Creating a Render Pipeline Asset and Render Pipeline Instance in a custom render pipeline</div>
</div>
<div class="icon tt right" data-distance="-40|-30|top">
<span class="next"><a href="CamerasOverview.html"></a></span><div class="tip">Cameras</div>
</div>
</div>
</div>
<div class="footer-wrapper">
<div class="footer clear">
<div class="copy">版权所有 © 2020 Unity Technologies. Publication 2020.3</div>
<div class="menu">
<a href="https://learn.unity.com/">教程</a><a href="https://answers.unity3d.com">社区答案</a><a href="https://support.unity3d.com/hc/en-us">知识库</a><a href="https://forum.unity3d.com">论坛</a><a href="https://unity3d.com/asset-store">Asset Store</a>
</div>
</div>
<div></div>
</div>
</div></div></div>
</div>
</body>
</html>
