<!DOCTYPE html><html class="no-js" lang="zh-cn">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
      new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
      })(window,document,'script','dataLayer','GTM-5V25JL6');
    </script><link href="https://fonts.googleapis.com/css?family=Roboto&amp;display=swap" rel="stylesheet">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="twitter:card" content="summary">
<meta property="og:title" content="低级原生插件 Profiler API - Unity 手册">
<title>低级原生插件 Profiler API - Unity 手册</title>
<meta name="description" content="The Unity Profiler is a tool that you can use to analyze and improve the performance of your application. The Profiler carries out frame time analysis of function calls in native Unity code and managed code in your application. You can use the ProfilerMarker API to insert timing markers into your own code to get a better understanding of the performance of specific areas of your application.">
<meta property="og:description" content="The Unity Profiler is a tool that you can use to analyze and improve the performance of your application. The Profiler carries out frame time analysis of function calls in native Unity code and managed code in your application. You can use the ProfilerMarker API to insert timing markers into your own code to get a better understanding of the performance of specific areas of your application.">
<meta name="author" content="Unity Technologies">
<link rel="shortcut icon" href="https://unity.com/themes/contrib/unity_base/images/favicons/favicon.ico">
<link rel="icon" type="image/png" href="../StaticFiles/images/favicons/favicon.png">
<link rel="apple-touch-icon-precomposed" sizes="152x152" href="../StaticFiles/images/favicons/apple-touch-icon-152x152.png">
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="../StaticFiles/images/favicons/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon-precomposed" sizes="120x120" href="../StaticFiles/images/favicons/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="../StaticFiles/images/favicons/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="../StaticFiles/images/favicons/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon-precomposed" href="../StaticFiles/images/favicons/apple-touch-icon.png">
<meta name="msapplication-TileColor" content="#222c37">
<meta name="msapplication-TileImage" content="../StaticFiles/images/favicons/tileicon-144x144.png">
<script type="text/javascript" src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" charset="UTF-8" data-domain-script="6e91be4c-3145-4ea2-aa64-89d716064836"></script><script type="text/javascript">
        function OptanonWrapper() { }
    </script><script>
      var docs_type = 'Manual';
      var lang = 'cn';
      var page = 'LowLevelNativePluginProfiler';
      if(!page) page = 'index';
      var version = '2020.3';
      var docs_versions = [{version: '2021.1',version_string: '2021.1',supported: true},{version: '2020.3',version_string: '2020.3',supported: true},{version: '2020.2',version_string: '2020.2',supported: false},{version: '2020.1',version_string: '2020.1',supported: false},{version: '2019.4',version_string: '2019.4',supported: true},{version: '2019.3',version_string: '2019.3',supported: false},{version: '2019.2',version_string: '2019.2',supported: false},{version: '2019.1',version_string: '2019.1',supported: false},{version: '2018.4',version_string: '2018.4',supported: true},{version: '2018.3',version_string: '2018.3',supported: false},{version: '2018.2',version_string: '2018.2',supported: false},{version: '2018.1',version_string: '2018.1',supported: false},{version: '2017.4',version_string: '2017.4',supported: false},{version: '2017.3',version_string: '2017.3',supported: false},{version: '2017.2',version_string: '2017.2',supported: false},{version: '2017.1',version_string: '2017.1',supported: false},{version: '5.6',version_string: '560',supported: false},];</script><script type="text/javascript" src="../StaticFiles/js/jquery.js"></script><script type="text/javascript" src="../StaticFiles/js/core.js"></script><script type="text/javascript" src="../StaticFiles/js/jquery.sidebar.min.js"></script><script type="text/javascript" src="docdata/toc.js"></script><script type="text/javascript" src=""></script><script type="text/javascript" src="../StaticFiles/js/custom.js"></script><link rel="stylesheet" type="text/css" href="../StaticFiles/css/core.css">
<link rel="stylesheet" type="text/css" href="../StaticFiles/css/custom.css">
<link rel="canonical" href="https://docs.unity3d.com/cn/2020.3/Manual/LowLevelNativePluginProfiler.html">
<link rel="alternate" href="https://docs.unity3d.com/en/2020.3/Manual/LowLevelNativePluginProfiler.html" hreflang="en">
<link rel="alternate" href="https://docs.unity3d.com/cn/2020.3/Manual/LowLevelNativePluginProfiler.html" hreflang="zh">
<link rel="alternate" href="https://docs.unity3d.com/ja/2020.3/Manual/LowLevelNativePluginProfiler.html" hreflang="ja">
<link rel="alternate" href="https://docs.unity3d.com/es/2020.3/Manual/LowLevelNativePluginProfiler.html" hreflang="es">
<link rel="alternate" href="https://docs.unity3d.com/kr/2020.3/Manual/LowLevelNativePluginProfiler.html" hreflang="ko">
<link rel="alternate" href="https://docs.unity3d.com/ru/2020.3/Manual/LowLevelNativePluginProfiler.html" hreflang="ru">
<link rel="alternate" href="https://docs.unity3d.com/2020.3/Documentation/Manual/LowLevelNativePluginProfiler.html" hreflang="x-default">
</head>
<body>
<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5V25JL6" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<div class="header-wrapper">
<div id="header" class="header"><div class="content">
<div class="spacer"><div class="menu">
<div id="nav-open" for="nav-input"><span></span></div>
<div class="logo"><a href="./index.html"></a></div>
<div class="search-form"><form action="30_search.html" method="get" class="apisearch">
<input type="text" name="q" placeholder="搜索手册..." autosave="Unity Reference" results="5" class="sbox field" id="q"><input type="submit" class="submit">
</form></div>
<ul class="menu-items">
<li class="menu-item"><a href="../Manual/index.html" class="selected">手册</a></li>
<li class="menu-item"><a href="../ScriptReference/index.html" class="">脚本 API</a></li>
</ul>
</div></div>
<div class="more">
<div class="filler"></div>
<ul><li><a href="https://unity3d.com/">
                unity3d.com
              </a></li></ul>
</div>
</div></div>
<div class="toolbar"><div class="content">
<div class="version-switcher">
<div class="current toggle" data-target=".version-list"><div class="version-number">
<div class="d-inline-block">
          Version:
          <b>2020.3</b>
</div>
<div class="d-inline-block arrow"></div>
</div></div>
<div class="version-list" style="display:none;">
<ul class="versions">
<li class="supported"><a class="docs_version_url_2021.1" href="/cn/2021.1/Manual/LowLevelNativePluginProfiler.html">2021.1</a></li>
<li class="supported"><a class="docs_version_url_2020.3" href="/cn/2020.3/Manual/LowLevelNativePluginProfiler.html">2020.3</a></li>
<li class=""><a class="docs_version_url_2020.2" href="/cn/2020.2/Manual/LowLevelNativePluginProfiler.html">2020.2</a></li>
<li class=""><a class="docs_version_url_2020.1" href="/cn/2020.1/Manual/LowLevelNativePluginProfiler.html">2020.1</a></li>
<li class="supported"><a class="docs_version_url_2019.4" href="/cn/2019.4/Manual/LowLevelNativePluginProfiler.html">2019.4</a></li>
<li class=""><a class="docs_version_url_2019.3" href="/cn/2019.3/Manual/LowLevelNativePluginProfiler.html">2019.3</a></li>
<li class=""><a class="docs_version_url_2019.2" href="/cn/2019.2/Manual/LowLevelNativePluginProfiler.html">2019.2</a></li>
<li class=""><a class="docs_version_url_2019.1" href="/cn/2019.1/Manual/LowLevelNativePluginProfiler.html">2019.1</a></li>
<li class="supported"><a class="docs_version_url_2018.4" href="/cn/2018.4/Manual/LowLevelNativePluginProfiler.html">2018.4</a></li>
<li class=""><a class="docs_version_url_2018.3" href="/cn/2018.3/Manual/LowLevelNativePluginProfiler.html">2018.3</a></li>
<li class=""><a class="docs_version_url_2018.2" href="/cn/2018.2/Manual/LowLevelNativePluginProfiler.html">2018.2</a></li>
<li class=""><a class="docs_version_url_2018.1" href="/cn/2018.1/Manual/LowLevelNativePluginProfiler.html">2018.1</a></li>
<li class=""><a class="docs_version_url_2017.4" href="/cn/2017.4/Manual/LowLevelNativePluginProfiler.html">2017.4</a></li>
<li class=""><a class="docs_version_url_2017.3" href="/cn/2017.3/Manual/LowLevelNativePluginProfiler.html">2017.3</a></li>
<li class=""><a class="docs_version_url_2017.2" href="/cn/2017.2/Manual/LowLevelNativePluginProfiler.html">2017.2</a></li>
<li class=""><a class="docs_version_url_2017.1" href="/cn/2017.1/Manual/LowLevelNativePluginProfiler.html">2017.1</a></li>
<li class=""><a class="docs_version_url_560" href="/cn/560/Manual/LowLevelNativePluginProfiler.html">5.6</a></li>
<div class="versionsWithThisPage" style="display:none;"><li><p>包含此页的版本：</p></li></div>
<div class="versionsWithoutThisPage" style="display:none;"><li><p>不含此页的版本：</p></li></div>
</ul>
<ul class="description">
<li>
<div class="supported-box"></div>受支持</li>
<li>
<div class="legacy-box"></div>旧版</li>
</ul>
</div>
</div>
<ul class="nav-menu-items">
<li class="menu-item"><a href="../Manual/index.html" class="selected">手册</a></li>
<li class="menu-item"><a href="../ScriptReference/index.html" class="">脚本 API</a></li>
</ul>
<div class="lang-switcher">
<div class="current toggle" data-target=".lang-list">
<div class="lbl">语言:
        <span class="b">中文</span>
</div>
<div class="arrow"></div>
</div>
<div class="lang-list" style="display:none;"><ul>
<li><a data-lang="en" href="/2020.3/Documentation/Manual/LowLevelNativePluginProfiler.html">English</a></li>
<li><a data-lang="cn" href="/cn/2020.3/Manual/LowLevelNativePluginProfiler.html">中文</a></li>
<li><a data-lang="ja" href="/ja/2020.3/Manual/LowLevelNativePluginProfiler.html">日本語</a></li>
<li><a data-lang="es" href="/es/2020.3/Manual/LowLevelNativePluginProfiler.html">Español</a></li>
<li><a data-lang="kr" href="/kr/2020.3/Manual/LowLevelNativePluginProfiler.html">한국어</a></li>
<li><a data-lang="ru" href="/ru/2020.3/Manual/LowLevelNativePluginProfiler.html">Русский</a></li>
</ul></div>
</div>
</div></div>
</div>
<div id="master-wrapper" class="master-wrapper clear">
<div id="sidebar" class="sidebar hidden"><div class="sidebar-wrap"><div class="content"><div class="sidebar-menu"><div class="toc">
<h2>手册</h2>
<div class="version-switcher">
<div class="current toggle" data-target=".version-list"><div class="version-number">
<div class="d-inline-block">
          Version:
          <b>2020.3</b>
</div>
<div class="d-inline-block arrow"></div>
</div></div>
<div class="version-list" style="display:none;">
<ul class="versions">
<li class="supported"><a class="docs_version_url_2021.1" href="/cn/2021.1/Manual/LowLevelNativePluginProfiler.html">2021.1</a></li>
<li class="supported"><a class="docs_version_url_2020.3" href="/cn/2020.3/Manual/LowLevelNativePluginProfiler.html">2020.3</a></li>
<li class=""><a class="docs_version_url_2020.2" href="/cn/2020.2/Manual/LowLevelNativePluginProfiler.html">2020.2</a></li>
<li class=""><a class="docs_version_url_2020.1" href="/cn/2020.1/Manual/LowLevelNativePluginProfiler.html">2020.1</a></li>
<li class="supported"><a class="docs_version_url_2019.4" href="/cn/2019.4/Manual/LowLevelNativePluginProfiler.html">2019.4</a></li>
<li class=""><a class="docs_version_url_2019.3" href="/cn/2019.3/Manual/LowLevelNativePluginProfiler.html">2019.3</a></li>
<li class=""><a class="docs_version_url_2019.2" href="/cn/2019.2/Manual/LowLevelNativePluginProfiler.html">2019.2</a></li>
<li class=""><a class="docs_version_url_2019.1" href="/cn/2019.1/Manual/LowLevelNativePluginProfiler.html">2019.1</a></li>
<li class="supported"><a class="docs_version_url_2018.4" href="/cn/2018.4/Manual/LowLevelNativePluginProfiler.html">2018.4</a></li>
<li class=""><a class="docs_version_url_2018.3" href="/cn/2018.3/Manual/LowLevelNativePluginProfiler.html">2018.3</a></li>
<li class=""><a class="docs_version_url_2018.2" href="/cn/2018.2/Manual/LowLevelNativePluginProfiler.html">2018.2</a></li>
<li class=""><a class="docs_version_url_2018.1" href="/cn/2018.1/Manual/LowLevelNativePluginProfiler.html">2018.1</a></li>
<li class=""><a class="docs_version_url_2017.4" href="/cn/2017.4/Manual/LowLevelNativePluginProfiler.html">2017.4</a></li>
<li class=""><a class="docs_version_url_2017.3" href="/cn/2017.3/Manual/LowLevelNativePluginProfiler.html">2017.3</a></li>
<li class=""><a class="docs_version_url_2017.2" href="/cn/2017.2/Manual/LowLevelNativePluginProfiler.html">2017.2</a></li>
<li class=""><a class="docs_version_url_2017.1" href="/cn/2017.1/Manual/LowLevelNativePluginProfiler.html">2017.1</a></li>
<li class=""><a class="docs_version_url_560" href="/cn/560/Manual/LowLevelNativePluginProfiler.html">5.6</a></li>
<div class="versionsWithThisPage" style="display:none;"><li><p>包含此页的版本：</p></li></div>
<div class="versionsWithoutThisPage" style="display:none;"><li><p>不含此页的版本：</p></li></div>
</ul>
<ul class="description">
<li>
<div class="supported-box"></div>受支持</li>
<li>
<div class="legacy-box"></div>旧版</li>
</ul>
</div>
</div>
<div class="clear"></div>
</div></div></div></div></div>
<div id="content-wrap" class="content-wrap opened-sidebar"><div class="content-block"><div class="content">
<div class="section">
<div class="breadcrumbs clear"><ul>
<li><a href="UnityManual.html">Unity User Manual 2020.3 (LTS)</a></li>
<li><a href="UnityOverview.html">在 Unity 中操作</a></li>
<li><a href="analysis.html">分析</a></li>
<li><a href="Profiler.html">Profiler overview</a></li>
<li>低级原生插件 Profiler API</li>
</ul></div>
<div class="mb20"><div class="nextprev clear">
<div class="icon tt left mr1" data-distance="-40|-30|top">
<span class="prev"><a href="profiler-module-editor.html"></a></span><div class="tip">Profiler Module Editor</div>
</div>
<div class="icon tt right" data-distance="-40|-30|top">
<span class="next"><a href="LogFiles.html"></a></span><div class="tip">日志文件</div>
</div>
</div></div>
<h1>低级原生插件 Profiler API</h1>
<!--BeginSwitchLink--><!--EndSwitchLink-->
<div class="clear"></div>

<p>The <a href="https://docs.unity3d.com/Manual/Profiler.html">Unity Profiler</a> is a tool that you can use to analyze and improve the performance of your application. The Profiler carries out <a href="https://docs.unity3d.com/Manual/ProfilerCPU.html">frame time analysis</a> of function calls in native Unity code and managed code in your application. You can use the <a href="https://docs.unity3d.com/ScriptReference/Unity.Profiling.ProfilerMarker.html">ProfilerMarker API</a> to insert timing markers into your own code to get a better understanding of the performance of specific areas of your application.</p>

<p>You can use the low-level <a href="https://docs.unity3d.com/Manual/NativePlugins.html">native plug-in</a> profiler API to extend the Profiler and profile the performance of native plug-in code, or to prepare profiling data to send to third-party profiling tools such as Razor (PS4), PIX (Xbox, Windows), Chrome Tracing, ETW, ITT, Vtune, or Telemetry. The low-level native plug-in Profiler APIs provide the following interfaces for communication between the Unity Profiler and external tooling:</p>

<ul>
<li>
<strong>IUnityProfiler</strong>: Use this interface to add instrumentation events to the Unity Profiler from C/C++ native plug-in code.</li>
<li>
<strong>IUnityProfilerCallbacks</strong>: Use this interface to intercept Unity Profiler events and store or redirect them to other tools.</li>
</ul>

<h2>IUnityProfiler API</h2>

<p>Use the IUnityProfiler plug-in API to add instrumentation to the C/C++ code of your native plug-ins.</p>

<p>The plug-in API is represented by IUnityProfiler interface, which is declared in the <code>IUnityProfiler.h</code> header. Unity stores the header in the <code>&lt;UnityInstallPath&gt;\Editor\Data\PluginAPI</code> folder of your Unity installation. (On macOS, right-click on the Unity application, and select <strong>Show Package Contents</strong>. The header is in <code>Contents\PluginAPI</code>).</p>

<table>
<colgroup>
<col style="text-align:left;">
<col style="text-align:left;">
</colgroup>

<thead>
<tr>
	<th style="text-align:left;"><strong>方法</strong></th>
	<th style="text-align:left;"><strong>描述</strong></th>
</tr>
</thead>

<tbody>
<tr>
	<td style="text-align:left;"><code>CreateMarker</code></td>
	<td style="text-align:left;">Creates a Profiler marker which represents a named instrumentation scope, which you can then use to generate instrumentation samples.</td>
</tr>
<tr>
	<td style="text-align:left;"><code>SetMarkerMetadataName</code></td>
	<td style="text-align:left;">Specifies custom parameter names which can be passed along with an instrumentation sample for a Profiler marker.</td>
</tr>
<tr>
	<td style="text-align:left;"><code>BeginSample</code></td>
	<td style="text-align:left;">Begins an instrumentation section of a code named after the Profiler marker.</td>
</tr>
<tr>
	<td style="text-align:left;"><code>EndSample</code></td>
	<td style="text-align:left;">Ends an instrumentation section.</td>
</tr>
<tr>
	<td style="text-align:left;"><code>EmitEvent</code></td>
	<td style="text-align:left;">Emits generic events with metadata.</td>
</tr>
<tr>
	<td style="text-align:left;"><code>IsEnabled</code></td>
	<td style="text-align:left;">Returns 1 if the Profiler is capturing the data.</td>
</tr>
<tr>
	<td style="text-align:left;"><code>IsAvailable</code></td>
	<td style="text-align:left;">Returns 1 for Editor or Development Players where the Profiler is available, and 0 for Release Players.</td>
</tr>
<tr>
	<td style="text-align:left;"><code>RegisterThread</code></td>
	<td style="text-align:left;">Registers the current thread under the specified name.</td>
</tr>
<tr>
	<td style="text-align:left;"><code>UnregisterThread</code></td>
	<td style="text-align:left;">Unregisters the current thread from Profiler.
</td>
</tr>
</tbody>
</table>

<h3>Usage example</h3>

<p>This example generates Profiler events that are then shown in the Profiler Window.</p>

<pre><code class="lang-csharp">#include &lt;IUnityInterface.h&gt;
#include &lt;IUnityProfiler.h&gt;

static IUnityProfiler* s_UnityProfiler = NULL;
static const UnityProfilerMarkerDesc* s_MyPluginMarker = NULL;
static bool s_IsDevelopmentBuild = false;

static void MyPluginWorkMethod()
{
    if (s_IsDevelopmentBuild)
        s_UnityProfiler-&gt;BeginSample(s_MyPluginMarker);

    // Code I want to see in Unity Profiler as "MyPluginMethod".
    // ...

    if (s_IsDevelopmentBuild)
        s_UnityProfiler-&gt;EndSample(s_MyPluginMarker);
}

extern "C" void UNITY_INTERFACE_EXPORT UNITY_INTERFACE_API UnityPluginLoad(IUnityInterfaces* unityInterfaces)
{
    s_UnityProfiler = unityInterfaces-&gt;Get&lt;IUnityProfiler&gt;();
    if (s_UnityProfiler == NULL)
        return;
    s_IsDevelopmentBuild = s_UnityProfiler-&gt;IsAvailable() != 0;
    s_UnityProfiler-&gt;CreateMarker(&amp;s_MyPluginMarker, "MyPluginMethod", kUnityProfilerCategoryOther, kUnityProfilerMarkerFlagDefault, 0);
}

extern "C" void UNITY_INTERFACE_EXPORT UNITY_INTERFACE_API UnityPluginUnload()
{
    s_UnityProfiler  = NULL;
}
</code></pre>

<h2>IUnityProfilerCallbacks API callbacks</h2>

<p>The native Profiler plug-in API provides an interface between Unity’s subsystems and third-party profiling APIs so you can use an external profiling tool to profile your Unity application. The IUnityProfilerCallbacks header exposes the API, which Unity stores in the <code>&lt;UnityInstallPath&gt;\Editor\Data\PluginAPI</code> folder of your Unity installation. (On macOS, right-click on the Unity application, and select <strong>Show Package Contents</strong>. The header is in <code>Contents\PluginAPI</code>).</p>

<p>The following Unity Profiler features help capture instrumentation data so you can analyze the performance of your application.</p>

<table>
<colgroup>
<col style="text-align:left;">
<col style="text-align:left;">
</colgroup>

<thead>
<tr>
	<th style="text-align:left;"><strong>Profiler feature</strong></th>
	<th style="text-align:left;"><strong>描述</strong></th>
</tr>
</thead>

<tbody>
<tr>
	<td style="text-align:left;"><strong>Categories</strong></td>
	<td style="text-align:left;">Unity groups profile data into categories (such as Rendering, Scripting and Animation), and assigns a color to each category. Color-coded categories help you visually distinguish the types of data in the Profiler window. The Profiler native plug-in API retrieves these colors so you can use them in an external profiling tool.</td>
</tr>
<tr>
	<td style="text-align:left;"><strong>Usage flags</strong></td>
	<td style="text-align:left;">Usage flags act as a filter that reduce the amount of data that Unity sends to an external profiling tool. You can use usage flags to remove unnecessary information from the profiling data before Unity sends it to the external tool. The Profiler applies the following usage flags to event markers so that you can filter the data:<br><br><strong>Availability flags</strong>that flag whether a marker is available in the Unity Editor, a development player, or a release player.<br><br><strong>Verbosity levels</strong> that correlate to the type of the task you are doing in the Editor, and the level of information that task requires (for example, internal, debug, or user level).</td>
</tr>
<tr>
	<td style="text-align:left;"><strong>Frame events</strong></td>
	<td style="text-align:left;">You can use the Profiler native plug-in API to perform frame-time analysis in an external profiling tool.</td>
</tr>
<tr>
	<td style="text-align:left;"><strong>Thread profiling</strong></td>
	<td style="text-align:left;">Unity does a significant amount of work on threads (for example, the main thread, render thread and job system worker thread). You can use the Profiler native plug-in API to enable profiling on any thread.</td>
</tr>
</tbody>
</table>

<p>To use the instrumentation data that the Unity Profiler generates in an external profiler, you can use these minimal set of callbacks in your C/C++ plug-in code that integrates the third-party profiler:</p>

<table>
<colgroup>
<col style="text-align:left;">
<col style="text-align:left;">
</colgroup>

<thead>
<tr>
	<th style="text-align:left;"><strong>Callback</strong></th>
	<th style="text-align:left;"><strong>功能</strong></th>
</tr>
</thead>

<tbody>
<tr>
	<td style="text-align:left;"><code>RegisterCreateCategoryCallback</code></td>
	<td style="text-align:left;">Registers a <code>IUnityProfilerCreateCategoryCallback</code> callback to get the Profiler category name and color whenever Unity creates a category.</td>
</tr>
<tr>
	<td style="text-align:left;"><code>RegisterCreateMarkerCallback</code></td>
	<td style="text-align:left;">Registers a <code>IUnityProfilerCreateMarkerCallback</code> callback which is called whenever Unity creates a marker. Use it to get the name, Profiler category, and usage flags of a marker. The const <code>UnityProfilerMarkerDesc* markerDesc</code> parameter of the callback function represents a persistent pointer to the marker description which you can use to filter markers in <code>RegisterMarkerEventCallback</code>.</td>
</tr>
<tr>
	<td style="text-align:left;"><code>RegisterMarkerEventCallback</code></td>
	<td style="text-align:left;">Registers a IUnityProfilerMarkerEventCallback callback that Unity invokes when single-shot, scoped, memory allocation, or garbage collection events happen. You can then use this callback to invoke the relevant functions in an external profiling tool. <strong>Note:</strong> Unity represents memory allocation events with the GC.Alloc marker, and garbage collection events with the GC.Collect markers.</td>
</tr>
<tr>
	<td style="text-align:left;"><code>RegisterFrameCallback</code></td>
	<td style="text-align:left;">Encapsulates samples into logical frames so external profiling tools that don’t use frames can use these samples. Also registers a callback that the Unity Profiler runs when Unity starts the next logical CPU frame.</td>
</tr>
<tr>
	<td style="text-align:left;"><code>RegisterCreateThreadCallback</code></td>
	<td style="text-align:left;">Registers a callback to get the internal thread name whenever Unity registers a thread for profiling.</td>
</tr>
</tbody>
</table>

<h3>Usage example</h3>

<p>This example shows you how to pass Unity Profiler events to another profiler which has push/pop semantics. It provides two functions:</p>

<ul>
<li>
<code>void MyProfilerPushMarker(const char* name)</code> - pushes a named marker.</li>
<li>
<code>void MyProfilerPopMarker()</code> - pops instrumentation marker.</li>
</ul>

<p>The following example provides the minimal implementation required to pass begin and end instrumentation events from the Unity Profiler to the external profiler:</p>

<pre><code class="lang-csharp">#include &lt;IUnityInterface.h&gt;
#include &lt;IUnityProfilerCallbacks.h&gt;

static IUnityProfilerCallbacks* s_UnityProfilerCallbacks = NULL;

static void UNITY_INTERFACE_API MyProfilerEventCallback(const UnityProfilerMarkerDesc* markerDesc, UnityProfilerMarkerEventType eventType, unsigned short eventDataCount, const UnityProfilerMarkerData* eventData, void* userData)
{
    switch (eventType)
    {
        case kUnityProfilerMarkerEventTypeBegin:
        {
            MyProfilerPushMarker(markerDesc-&gt;name);
            break;
        }
        case kUnityProfilerMarkerEventTypeEnd:
        {
            MyProfilerPopMarker();
            break;
        }
    }
}

static void UNITY_INTERFACE_API MyProfilerCreateMarkerCallback(const UnityProfilerMarkerDesc* markerDesc, void* userData)
{
    s_UnityProfilerCallbacks-&gt;RegisterMarkerEventCallback(markerDesc, MyProfilerEventCallback, NULL);
}

extern "C" void UNITY_INTERFACE_EXPORT UNITY_INTERFACE_API UnityPluginLoad(IUnityInterfaces* unityInterfaces)
{
    s_UnityProfilerCallbacks = unityInterfaces-&gt;Get&lt;IUnityProfilerCallbacks&gt;();
    s_UnityProfilerCallbacks-&gt;RegisterCreateMarkerCallback(&amp;MyProfilerCreateMarkerCallback, NULL);
}

extern "C" void UNITY_INTERFACE_EXPORT UNITY_INTERFACE_API UnityPluginUnload()
{
    s_UnityProfilerCallbacks-&gt;UnregisterCreateMarkerCallback(&amp;MyProfilerCreateMarkerCallback, NULL);
    s_UnityProfilerCallbacks-&gt;UnregisterMarkerEventCallback(NULL, &amp;MyProfilerEventCallback, NULL);
}
</code></pre>

<p><strong>Note:</strong> To unregister the given callback from all markers, run <code>UnregisterEventCallback</code> with the first parameter set to <code>null</code>.</p>

<h4>UnitySystracePlugin example</h4>

<p>You can register and unregister marker callbacks dynamically, once every frame. The following example minimizes profiling overhead by enabling and disabling callbacks, depending on a third party profile state.</p>

<pre><code class="lang-csharp">| static void UNITY_INTERFACE_API SystraceFrameCallback(void* userData)
{
    bool isCapturing = ATrace_isEnabled();
    if (isCapturing != s_isCapturing)
    {
        s_isCapturing = isCapturing;
        if (isCapturing)
        {
            s_UnityProfilerCallbacks-&gt;
              RegisterCreateMarkerCallback(SystraceCreateEventCallback, NULL);
        }
        else
        {
            s_UnityProfilerCallbacks-&gt;
              UnregisterCreateMarkerCallback(SystraceCreateEventCallback, NULL);
            s_UnityProfilerCallbacks-&gt;
              UnregisterMarkerEventCallback(NULL, SystraceEventCallback, NULL);
        }
    }
}
</code></pre>

<p><strong>Note:</strong> To unregister the given callback from all markers, run <code>UnregisterEventCallback</code> with the first parameter set to <code>null</code>.</p>

<h3>Special markers</h3>

<p>Unity has the following special markers that contain useful metadata:</p>

<ul>
<li>Profiler.DefaultMarker</li>
<li>GC.Alloc</li>
</ul>

<h4>Profiler.DefaultMarker</h4>

<p>The <code>Profiler.DefaultMarker</code> is a marker that Unity reserves for <a href="https://docs.unity3d.com/ScriptReference/Profiling.Profiler.BeginSample.html">Profiler.BeginSample</a> and <a href="https://docs.unity3d.com/ScriptReference/Profiling.Profiler.EndSample.html">Profiler.EndSample</a> events.</p>

<p>In the example above, <code>kUnityProfilerMarkerEventTypeBegin eventType</code> corresponds to the <code>Profiler.BeginSample</code> event and has the following data:</p>

<ul>
<li>Int32: The <code>UnityEngine.Object</code> instance ID. This is 0 if the object is not specified.</li>
<li>UInt16 数组：传递给 <code>Profiler.BeginSample</code> 的 UTF16 字符串。此大小以字节为单位。</li>
<li>UInt32：类别索引。</li>
</ul>

<h4>GC.Alloc</h4>

<p><code>GC.Alloc</code> is a marker that corresponds to garbage collection allocation. It has the following data:</p>

<ul>
<li>Int64：分配大小。</li>
</ul>
<div class="nextprev clear">
<div class="icon tt left mr1" data-distance="-40|-30|top">
<span class="prev"><a href="profiler-module-editor.html"></a></span><div class="tip">Profiler Module Editor</div>
</div>
<div class="icon tt right" data-distance="-40|-30|top">
<span class="next"><a href="LogFiles.html"></a></span><div class="tip">日志文件</div>
</div>
</div>
</div>
<div class="footer-wrapper">
<div class="footer clear">
<div class="copy">版权所有 © 2020 Unity Technologies. Publication 2020.3</div>
<div class="menu">
<a href="https://learn.unity.com/">教程</a><a href="https://answers.unity3d.com">社区答案</a><a href="https://support.unity3d.com/hc/en-us">知识库</a><a href="https://forum.unity3d.com">论坛</a><a href="https://unity3d.com/asset-store">Asset Store</a>
</div>
</div>
<div></div>
</div>
</div></div></div>
</div>
</body>
</html>
