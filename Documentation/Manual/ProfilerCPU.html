<!DOCTYPE html><html class="no-js" lang="zh-cn">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
      new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
      })(window,document,'script','dataLayer','GTM-5V25JL6');
    </script><link href="https://fonts.googleapis.com/css?family=Roboto&amp;display=swap" rel="stylesheet">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="twitter:card" content="summary">
<meta property="og:title" content="CPU Usage Profiler 模块 - Unity 手册">
<title>CPU Usage Profiler 模块 - Unity 手册</title>
<meta property="og:image" content="https://docs.unity3d.com/cn/2020.3/uploads/Main/profiler-cpu-window.png">
<meta name="description" content="CPU Usage Profiler 模块包含一个图表，其中显示应用程序中的时间花费情况。通过该图表可以概要了解应用程序花费时间的所有重要方面（例如渲染、脚本和动画）。文档的此部分涵盖：">
<meta property="og:description" content="CPU Usage Profiler 模块包含一个图表，其中显示应用程序中的时间花费情况。通过该图表可以概要了解应用程序花费时间的所有重要方面（例如渲染、脚本和动画）。文档的此部分涵盖：">
<meta name="author" content="Unity Technologies">
<link rel="shortcut icon" href="https://unity.com/themes/contrib/unity_base/images/favicons/favicon.ico">
<link rel="icon" type="image/png" href="../StaticFiles/images/favicons/favicon.png">
<link rel="apple-touch-icon-precomposed" sizes="152x152" href="../StaticFiles/images/favicons/apple-touch-icon-152x152.png">
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="../StaticFiles/images/favicons/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon-precomposed" sizes="120x120" href="../StaticFiles/images/favicons/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="../StaticFiles/images/favicons/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="../StaticFiles/images/favicons/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon-precomposed" href="../StaticFiles/images/favicons/apple-touch-icon.png">
<meta name="msapplication-TileColor" content="#222c37">
<meta name="msapplication-TileImage" content="../StaticFiles/images/favicons/tileicon-144x144.png">
<script type="text/javascript" src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" charset="UTF-8" data-domain-script="6e91be4c-3145-4ea2-aa64-89d716064836"></script><script type="text/javascript">
        function OptanonWrapper() { }
    </script><script>
      var docs_type = 'Manual';
      var lang = 'cn';
      var page = 'ProfilerCPU';
      if(!page) page = 'index';
      var version = '2020.3';
      var docs_versions = [{version: '2021.1',version_string: '2021.1',supported: true},{version: '2020.3',version_string: '2020.3',supported: true},{version: '2020.2',version_string: '2020.2',supported: false},{version: '2020.1',version_string: '2020.1',supported: false},{version: '2019.4',version_string: '2019.4',supported: true},{version: '2019.3',version_string: '2019.3',supported: false},{version: '2019.2',version_string: '2019.2',supported: false},{version: '2019.1',version_string: '2019.1',supported: false},{version: '2018.4',version_string: '2018.4',supported: true},{version: '2018.3',version_string: '2018.3',supported: false},{version: '2018.2',version_string: '2018.2',supported: false},{version: '2018.1',version_string: '2018.1',supported: false},{version: '2017.4',version_string: '2017.4',supported: false},{version: '2017.3',version_string: '2017.3',supported: false},{version: '2017.2',version_string: '2017.2',supported: false},{version: '2017.1',version_string: '2017.1',supported: false},{version: '5.6',version_string: '560',supported: false},];</script><script type="text/javascript" src="../StaticFiles/js/jquery.js"></script><script type="text/javascript" src="../StaticFiles/js/core.js"></script><script type="text/javascript" src="../StaticFiles/js/jquery.sidebar.min.js"></script><script type="text/javascript" src="docdata/toc.js"></script><script type="text/javascript" src=""></script><script type="text/javascript" src="../StaticFiles/js/custom.js"></script><link rel="stylesheet" type="text/css" href="../StaticFiles/css/core.css">
<link rel="stylesheet" type="text/css" href="../StaticFiles/css/custom.css">
<link rel="canonical" href="https://docs.unity3d.com/cn/2020.3/Manual/ProfilerCPU.html">
<link rel="alternate" href="https://docs.unity3d.com/en/2020.3/Manual/ProfilerCPU.html" hreflang="en">
<link rel="alternate" href="https://docs.unity3d.com/cn/2020.3/Manual/ProfilerCPU.html" hreflang="zh">
<link rel="alternate" href="https://docs.unity3d.com/ja/2020.3/Manual/ProfilerCPU.html" hreflang="ja">
<link rel="alternate" href="https://docs.unity3d.com/es/2020.3/Manual/ProfilerCPU.html" hreflang="es">
<link rel="alternate" href="https://docs.unity3d.com/kr/2020.3/Manual/ProfilerCPU.html" hreflang="ko">
<link rel="alternate" href="https://docs.unity3d.com/ru/2020.3/Manual/ProfilerCPU.html" hreflang="ru">
<link rel="alternate" href="https://docs.unity3d.com/2020.3/Documentation/Manual/ProfilerCPU.html" hreflang="x-default">
</head>
<body>
<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5V25JL6" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<div class="header-wrapper">
<div id="header" class="header"><div class="content">
<div class="spacer"><div class="menu">
<div id="nav-open" for="nav-input"><span></span></div>
<div class="logo"><a href="./index.html"></a></div>
<div class="search-form"><form action="30_search.html" method="get" class="apisearch">
<input type="text" name="q" placeholder="搜索手册..." autosave="Unity Reference" results="5" class="sbox field" id="q"><input type="submit" class="submit">
</form></div>
<ul class="menu-items">
<li class="menu-item"><a href="../Manual/index.html" class="selected">手册</a></li>
<li class="menu-item"><a href="../ScriptReference/index.html" class="">脚本 API</a></li>
</ul>
</div></div>
<div class="more">
<div class="filler"></div>
<ul><li><a href="https://unity3d.com/">
                unity3d.com
              </a></li></ul>
</div>
</div></div>
<div class="toolbar"><div class="content">
<div class="version-switcher">
<div class="current toggle" data-target=".version-list"><div class="version-number">
<div class="d-inline-block">
          Version:
          <b>2020.3</b>
</div>
<div class="d-inline-block arrow"></div>
</div></div>
<div class="version-list" style="display:none;">
<ul class="versions">
<li class="supported"><a class="docs_version_url_2021.1" href="/cn/2021.1/Manual/ProfilerCPU.html">2021.1</a></li>
<li class="supported"><a class="docs_version_url_2020.3" href="/cn/2020.3/Manual/ProfilerCPU.html">2020.3</a></li>
<li class=""><a class="docs_version_url_2020.2" href="/cn/2020.2/Manual/ProfilerCPU.html">2020.2</a></li>
<li class=""><a class="docs_version_url_2020.1" href="/cn/2020.1/Manual/ProfilerCPU.html">2020.1</a></li>
<li class="supported"><a class="docs_version_url_2019.4" href="/cn/2019.4/Manual/ProfilerCPU.html">2019.4</a></li>
<li class=""><a class="docs_version_url_2019.3" href="/cn/2019.3/Manual/ProfilerCPU.html">2019.3</a></li>
<li class=""><a class="docs_version_url_2019.2" href="/cn/2019.2/Manual/ProfilerCPU.html">2019.2</a></li>
<li class=""><a class="docs_version_url_2019.1" href="/cn/2019.1/Manual/ProfilerCPU.html">2019.1</a></li>
<li class="supported"><a class="docs_version_url_2018.4" href="/cn/2018.4/Manual/ProfilerCPU.html">2018.4</a></li>
<li class=""><a class="docs_version_url_2018.3" href="/cn/2018.3/Manual/ProfilerCPU.html">2018.3</a></li>
<li class=""><a class="docs_version_url_2018.2" href="/cn/2018.2/Manual/ProfilerCPU.html">2018.2</a></li>
<li class=""><a class="docs_version_url_2018.1" href="/cn/2018.1/Manual/ProfilerCPU.html">2018.1</a></li>
<li class=""><a class="docs_version_url_2017.4" href="/cn/2017.4/Manual/ProfilerCPU.html">2017.4</a></li>
<li class=""><a class="docs_version_url_2017.3" href="/cn/2017.3/Manual/ProfilerCPU.html">2017.3</a></li>
<li class=""><a class="docs_version_url_2017.2" href="/cn/2017.2/Manual/ProfilerCPU.html">2017.2</a></li>
<li class=""><a class="docs_version_url_2017.1" href="/cn/2017.1/Manual/ProfilerCPU.html">2017.1</a></li>
<li class=""><a class="docs_version_url_560" href="/cn/560/Manual/ProfilerCPU.html">5.6</a></li>
<div class="versionsWithThisPage" style="display:none;"><li><p>包含此页的版本：</p></li></div>
<div class="versionsWithoutThisPage" style="display:none;"><li><p>不含此页的版本：</p></li></div>
</ul>
<ul class="description">
<li>
<div class="supported-box"></div>受支持</li>
<li>
<div class="legacy-box"></div>旧版</li>
</ul>
</div>
</div>
<ul class="nav-menu-items">
<li class="menu-item"><a href="../Manual/index.html" class="selected">手册</a></li>
<li class="menu-item"><a href="../ScriptReference/index.html" class="">脚本 API</a></li>
</ul>
<div class="lang-switcher">
<div class="current toggle" data-target=".lang-list">
<div class="lbl">语言:
        <span class="b">中文</span>
</div>
<div class="arrow"></div>
</div>
<div class="lang-list" style="display:none;"><ul>
<li><a data-lang="en" href="/2020.3/Documentation/Manual/ProfilerCPU.html">English</a></li>
<li><a data-lang="cn" href="/cn/2020.3/Manual/ProfilerCPU.html">中文</a></li>
<li><a data-lang="ja" href="/ja/2020.3/Manual/ProfilerCPU.html">日本語</a></li>
<li><a data-lang="es" href="/es/2020.3/Manual/ProfilerCPU.html">Español</a></li>
<li><a data-lang="kr" href="/kr/2020.3/Manual/ProfilerCPU.html">한국어</a></li>
<li><a data-lang="ru" href="/ru/2020.3/Manual/ProfilerCPU.html">Русский</a></li>
</ul></div>
</div>
</div></div>
</div>
<div id="master-wrapper" class="master-wrapper clear">
<div id="sidebar" class="sidebar hidden"><div class="sidebar-wrap"><div class="content"><div class="sidebar-menu"><div class="toc">
<h2>手册</h2>
<div class="version-switcher">
<div class="current toggle" data-target=".version-list"><div class="version-number">
<div class="d-inline-block">
          Version:
          <b>2020.3</b>
</div>
<div class="d-inline-block arrow"></div>
</div></div>
<div class="version-list" style="display:none;">
<ul class="versions">
<li class="supported"><a class="docs_version_url_2021.1" href="/cn/2021.1/Manual/ProfilerCPU.html">2021.1</a></li>
<li class="supported"><a class="docs_version_url_2020.3" href="/cn/2020.3/Manual/ProfilerCPU.html">2020.3</a></li>
<li class=""><a class="docs_version_url_2020.2" href="/cn/2020.2/Manual/ProfilerCPU.html">2020.2</a></li>
<li class=""><a class="docs_version_url_2020.1" href="/cn/2020.1/Manual/ProfilerCPU.html">2020.1</a></li>
<li class="supported"><a class="docs_version_url_2019.4" href="/cn/2019.4/Manual/ProfilerCPU.html">2019.4</a></li>
<li class=""><a class="docs_version_url_2019.3" href="/cn/2019.3/Manual/ProfilerCPU.html">2019.3</a></li>
<li class=""><a class="docs_version_url_2019.2" href="/cn/2019.2/Manual/ProfilerCPU.html">2019.2</a></li>
<li class=""><a class="docs_version_url_2019.1" href="/cn/2019.1/Manual/ProfilerCPU.html">2019.1</a></li>
<li class="supported"><a class="docs_version_url_2018.4" href="/cn/2018.4/Manual/ProfilerCPU.html">2018.4</a></li>
<li class=""><a class="docs_version_url_2018.3" href="/cn/2018.3/Manual/ProfilerCPU.html">2018.3</a></li>
<li class=""><a class="docs_version_url_2018.2" href="/cn/2018.2/Manual/ProfilerCPU.html">2018.2</a></li>
<li class=""><a class="docs_version_url_2018.1" href="/cn/2018.1/Manual/ProfilerCPU.html">2018.1</a></li>
<li class=""><a class="docs_version_url_2017.4" href="/cn/2017.4/Manual/ProfilerCPU.html">2017.4</a></li>
<li class=""><a class="docs_version_url_2017.3" href="/cn/2017.3/Manual/ProfilerCPU.html">2017.3</a></li>
<li class=""><a class="docs_version_url_2017.2" href="/cn/2017.2/Manual/ProfilerCPU.html">2017.2</a></li>
<li class=""><a class="docs_version_url_2017.1" href="/cn/2017.1/Manual/ProfilerCPU.html">2017.1</a></li>
<li class=""><a class="docs_version_url_560" href="/cn/560/Manual/ProfilerCPU.html">5.6</a></li>
<div class="versionsWithThisPage" style="display:none;"><li><p>包含此页的版本：</p></li></div>
<div class="versionsWithoutThisPage" style="display:none;"><li><p>不含此页的版本：</p></li></div>
</ul>
<ul class="description">
<li>
<div class="supported-box"></div>受支持</li>
<li>
<div class="legacy-box"></div>旧版</li>
</ul>
</div>
</div>
<div class="clear"></div>
</div></div></div></div></div>
<div id="content-wrap" class="content-wrap opened-sidebar"><div class="content-block"><div class="content">
<div class="section">
<div class="breadcrumbs clear"><ul>
<li><a href="UnityManual.html">Unity 用户手册 2020.3 (LTS)</a></li>
<li><a href="UnityOverview.html">在 Unity 中操作</a></li>
<li><a href="analysis.html">分析</a></li>
<li><a href="Profiler.html">性能分析器概述</a></li>
<li><a href="ProfilerWindow.html">Profiler 窗口</a></li>
<li>CPU Usage Profiler 模块</li>
</ul></div>
<div class="mb20"><div class="nextprev clear">
<div class="icon tt left mr1" data-distance="-40|-30|top">
<span class="prev"><a href="ProfilerAudio.html"></a></span><div class="tip">Audio Profiler 模块</div>
</div>
<div class="icon tt right" data-distance="-40|-30|top">
<span class="next"><a href="ProfilerGI.html"></a></span><div class="tip">Global Illumination Profiler 模块</div>
</div>
</div></div>
<h1>CPU Usage Profiler 模块</h1>
<!--BeginSwitchLink--><!--EndSwitchLink-->
<div class="clear"></div>

<p>CPU Usage Profiler 模块包含一个图表，其中显示应用程序中的时间花费情况。通过该图表可以概要了解应用程序花费时间的所有重要方面（例如渲染、脚本和动画）。文档的此部分涵盖：</p>

<ul>
<li><a href="#charts">图表类别</a></li>
<li>
<a href="#details-pane">模块详细信息面板</a>

<ul>
<li><a href="#live-setting">Live 设置</a></li>
<li><a href="#full-names-setting">Show Full Scripting Method Names 设置</a></li>
</ul>
</li>
<li>
<a href="#timeline">Timeline 视图</a>

<ul>
<li><a href="#flow-events">Flow events</a></li>
</ul>
</li>
<li><a href="#hierarchy">Hierarchy 和 Raw Hierarchy 视图</a></li>
<li><a href="#call-stacks">分配调用栈</a></li>
<li><a href="#samples">常用标记</a></li>
</ul>

<p><a name="charts"></a></p>

<h2>图表类别</h2>

<p>CPU Usage Profiler 模块的图表可跟踪应用程序主线程中花费的时间。这些时间被分为九个类别。要更改图表中类别的顺序，可以在图表的图例中拖放这些类别。还可以单击某个类别的有色图例以切换是否显示。</p>

<figure>
<img src="../uploads/Main/profiler-cpu-window.png" alt="CPU Usage Profiler 模块">
<figcaption>CPU Usage Profiler 模块</figcaption>
</figure>

<table>
<colgroup>
<col style="text-align:left;">
<col style="text-align:left;">
</colgroup>

<thead>
<tr>
	<th style="text-align:left;"><strong>类别</strong></th>
	<th style="text-align:left;"><strong>描述</strong></th>
</tr>
</thead>

<tbody>
<tr>
	<td style="text-align:left;"><strong>Rendering</strong></td>
	<td style="text-align:left;">应用程序花费多少时间来渲染图形。</td>
</tr>
<tr>
	<td style="text-align:left;"><strong>Scripts</strong></td>
	<td style="text-align:left;">应用程序花费多少时间来运行脚本。</td>
</tr>
<tr>
	<td style="text-align:left;"><strong>Physics</strong></td>
	<td style="text-align:left;">应用程序在物理引擎上花费多少时间。</td>
</tr>
<tr>
	<td style="text-align:left;"><strong>动画</strong></td>
	<td style="text-align:left;">应用程序花费多少时间来动画化应用程序中带蒙皮的网格渲染器 (Skinned Mesh Renderers)、游戏对象和其他组件。这还包括针对 Animation 组件和 Animator 组件所用的系统进行计算所花费的时间。</td>
</tr>
<tr>
	<td style="text-align:left;"><strong>GarbageCollector</strong></td>
	<td style="text-align:left;">应用程序花费多少时间来运行<a href="../ScriptReference/Scripting.GarbageCollector.html">垃圾回收器</a>。</td>
</tr>
<tr>
	<td style="text-align:left;"><strong>VSync</strong></td>
	<td style="text-align:left;">应用程序每帧花费多少时间来等待 <a href="../ScriptReference/Application-targetFrameRate.html">targetFrameRate</a> 或下一个要同步的 VBlank。此时间基于 <a href="../ScriptReference/QualitySettings-vSyncCount.html">QualitySettings.vSyncCount</a> 值、目标帧率或者 VSync 设置（即运行应用程序的平台的默认或强制最大值）。有关 VSync 的更多信息，请参阅本文档中的<a href="#samples">渲染和 VSync 样本</a>部分。</td>
</tr>
<tr>
	<td style="text-align:left;"><strong>Global Illumination</strong></td>
	<td style="text-align:left;">应用程序在光照中花费多少时间。</td>
</tr>
<tr>
	<td style="text-align:left;"><strong>UI</strong></td>
	<td style="text-align:left;">应用程序花费多少时间来显示其 UI。</td>
</tr>
<tr>
	<td style="text-align:left;"><strong>Others</strong></td>
	<td style="text-align:left;">应用程序在不属于任何其他类别的代码中花费多少时间。此事件包括整个 EditorLoop 或者是 Editor 中对运行模式进行性能分析时的性能分析开销等方面。</td>
</tr>
</tbody>
</table>

<p><a name="details-pane"></a></p>

<h2>模块详细信息面板</h2>

<p>选择 CPU Usage 模块时，下面的详细信息面板将显示应用程序在选定帧内花费的时间的细分信息。可以将时间数据显示为时间轴或层级表。要更改显示视图，请使用详细信息面板中的左上角下拉选单（默认设置为 __Timeline__）。三个可用视图为：</p>

<table>
<colgroup>
<col style="text-align:left;">
<col style="text-align:left;">
</colgroup>

<thead>
<tr>
	<th style="text-align:left;"><strong>视图</strong></th>
	<th style="text-align:left;"><strong>功能</strong></th>
</tr>
</thead>

<tbody>
<tr>
	<td style="text-align:left;"><a href="#timeline">Timeline</a></td>
	<td style="text-align:left;">显示特定帧的时间细分信息，以及该帧长度的时间轴。只有在此视图模式中才可以一次性查看所有线程上的时间以及在帧内运行线程的时间，因此可以关联各个线程的时间（例如<a href="JobSystem.html">作业系统</a>工作线程在主线程上的系统调度这些线程之后启动）。</td>
</tr>
<tr>
	<td style="text-align:left;"><a href="#hierarchy">Hierarchy</a></td>
	<td style="text-align:left;">按时间数据的内部层级结构对这些数据分组。此选项以降序列表格式显示应用程序调用的元素，默认按花费的时间排序。还可以按分配的脚本内存量 (<strong>GC Alloc</strong>) 或调用次数对信息进行排序。要更改用于对表进行排序的列，请单击该表列的标题。</td>
</tr>
<tr>
	<td style="text-align:left;"><a href="#hierarchy">Raw Hierarchy</a></td>
	<td style="text-align:left;">以类似于发生计时的调用栈的层级结构显示时间数据。Unity 在此模式中单独列出每个调用栈，而不是像在 <strong>Hierarchy</strong> 视图中一样将它们合并。</td>
</tr>
</tbody>
</table>

<p><a name="live-setting"></a></p>

<h3>Live 设置</h3>

<p>当您开始在运行模式 (Playmode) 或 Editor 中记录新数据时，__Live__ 设置（在每个视图中都可用）可在模块详细信息面板中显示有关当前帧或选定帧的信息。为了启用此设置，请单击模块详细信息下拉选单旁的 <strong>Live</strong> 按钮。默认情况下，此设置已禁用，并且在您记录数据时模块详细信息面板为空白。<strong>注意：</strong>重绘 Profiler 窗口时，此设置会增加 <code>EditorLoop</code> 的开销。</p>

<p><a name="full-names-setting"></a></p>

<h3>Show Full Scripting Method Names 设置</h3>

<p>此外，在每个视图中，可以选择 <strong>More Items</strong> 菜单 (⋮) 并启用 __Show Full Scripting Method Names__，此设置随后显示所有脚本方法的完全限定名称 (<code>Assembly::Class::MethodName</code>)。</p>

<figure>
<img src="../uploads/Main/profiler-cpu-full-scripting-methods.png" alt="A：未启用 Show Full Scripting Method Names 的情况下，Hierarchy 视图和 Timeline 视图中的脚本方法&lt;br/&gt; B：已启用 Show Full Scripting Method Names 的情况下，Hierarchy 视图和 Timeline 视图中的脚本方法">
<figcaption><strong>A：</strong>未启用 <strong>Show Full Scripting Method Names</strong> 的情况下，Hierarchy 视图和 Timeline 视图中的脚本方法<br>
<strong>B：</strong>已启用 <strong>Show Full Scripting Method Names</strong> 的情况下，Hierarchy 视图和 Timeline 视图中的脚本方法</figcaption>
</figure>

<p><a name="timeline"></a></p>

<h2>Timeline 视图</h2>

<figure>
<img src="../uploads/Main/profiler-cpu-timeline-view.png" alt="CPU Usage Profiler 模块以及 Timeline 视图">
<figcaption>CPU Usage Profiler 模块以及 Timeline 视图</figcaption>
</figure>

<p><strong>Timeline</strong> 视图是 CPU Usage Profiler 模块的默认视图。该视图简单列出了应用程序中所花费的时间情况以及时间的相互关联情况。</p>

<p>与 Hierarchy 视图不同，Timeline 视图沿同一时间轴在各自子部分中显示所有线程的性能分析数据。Hierarchy 视图一次只显示一个线程（默认显示主线程）的性能分析数据。此外，这些视图仅显示样本的持续时间，而 Timeline 视图会显示每个样本发生的时间。</p>

<p>使用 Timeline 视图可以查看不同线程上的活动在并行执行过程中如何相互关联。在此处可以了解对不同线程（例如<a href="JobSystem.html">作业系统</a>的工作线程）的使用程度、线程上工作的排队方式以及任何线程是处于空闲状态（Idle 样本）还是在等待另一线程或作业完成（Wait for x 样本）。</p>

<h3>导航和选择项目</h3>

<p>要放大时间轴的区域，请使用鼠标上的滚轮，或在按住 Alt 键的同时按住鼠标右键进行拖动。也可以使用水平滚动条的两端来放大。按下键盘上的 <strong>A</strong> 键可重置缩放，以便可看到整个帧时间。</p>

<p>每当在线程底部看到白色箭头时，都可以单击该箭头来展开线程以便显示所有行，或者再次单击以便仅显示顶部的行。也可以拖动分隔线程的行以重新调整可看到的行数。双击该行可将线程部分的高度设置为调用栈的最大深度。要平移视图，请按鼠标中键，或按住 Alt 键（在 macOS 上为 Command 键），然后按鼠标左键。</p>

<p>要折叠和展开线程组，请单击视图最左侧的线程名称旁的折叠箭头。</p>

<p>要查看某一项对 CPU 图表的贡献，请在下方面板中选择这一项。性能分析器会突出显示该项的贡献，并使图表的其余部分变暗。要取消选择该项，请单击视图中的其他位置。按 <strong>F</strong> 键可以聚焦所选的当前样本，或者如果未选择任何项，则会显示默认的缩放水平。</p>

<figure>
<img src="../uploads/Main/profiler-cpu-selected-module.png" alt="Timeline 视图中的 CPU Usage 模块，并且选择了一项">
<figcaption>Timeline 视图中的 CPU Usage 模块，并且选择了一项</figcaption>
</figure>

<p>上图中，所选项上的工具提示可以提供更多详细信息，例如所有线程中的实例数和该样本的总时间。<strong>GC.Alloc</strong> 样本显示为红色/洋红色，并显示分配的大小。</p>

<p>要在工具提示中显示托管的调用栈，请导航到 Profiler 窗口的工具栏，然后选择 Call Stacks 按钮。必须先启用此属性，然后对帧进行性能分析以显示帧的调用栈。有关更多信息，请参阅关于<a href="#call-stacks">调用栈</a>的部分。</p>

<p><a name="flow-events"></a></p>

<h3>Flow Events</h3>

<p>为了帮助您直观地了解 Unity 如何跨线程调度作业，您可以使用 <strong>Flow Events</strong> 设置。此设置显示系统、作业和线程之间的关系。要启用此设置，请选择 Timeline 视图窗格的右上角的 <strong>More</strong> menu (⋮) ，然后选择 <strong>Show Flow Events</strong>。</p>

<p>启用此设置后，性能分析器会将白色事件标记添加到用于调度作业或等待调度作业完成的性能分析器样本。它还会使不相关的样本变暗，以便您可以更容易地看到您选择的样本。</p>

<p>性能分析器将三种类型的箭头添加到样本中：</p>

<ul>
<li>向下箭头：指示流程的开始，并且此样本调度了某些工作。</li>
<li>向右箭头：指示流程中的下一个项目，并且另一个样本调度了此工作。</li>
<li>向上箭头：指示流程的结束，以及此样本上的工作已结束或同步。</li>
</ul>

<figure>
<img src="../uploads/Main/profiler-flow-events.png" alt="启用了 Flow Events 的 Timeline CPU Profiler 视图。请注意某些 Profiler 样本上的白色事件标记。">
<figcaption>启用了 Flow Events 的 Timeline CPU Profiler 视图。请注意某些 Profiler 样本上的白色事件标记。</figcaption>
</figure>

<p>当您选择一个样本时，Profiler 将相关的流程事件标记用线条连接在一起。粗线条突出显示您选择的特定流程。例如，如果一个 <code>begin</code> 样本指向另外两个 <code>next</code> 样本，当您单击 <code>next</code> 样本之一时，性能分析器会为其绘制一条较粗的线条。</p>

<p>此视图有助于发现代码的执行流程、等待完成的工作，并帮助您以直观方式发现代码的依赖关系。</p>

<figure>
<img src="../uploads/Main/profiler-flow-events-selected.png" alt="启用了 Flow Events 并选择了样本的 Timeline CPU Profiler 视图。">
<figcaption>启用了 Flow Events 并选择了样本的 Timeline CPU Profiler 视图。</figcaption>
</figure>

<p><a name="hierarchy"></a></p>

<h2>Hierarchy 和 Raw Hierarchy 视图</h2>

<p>切换到 <strong>Hierarchy</strong> 或 <strong>Raw Hierarchy</strong> 视图时，只要样本在主线程上，您所做的选择就会继续存在。如果无法立即找到您的选择，请按 F 键进行聚焦。</p>

<figure>
<img src="../uploads/Main/profiler-cpu-hierarchy-view.png" alt="CPU Usage Profiler 模块以及 Hierarchy 视图">
<figcaption>CPU Usage Profiler 模块以及 Hierarchy 视图</figcaption>
</figure>

<p><strong>Hierarchy</strong> 视图列出已进行性能分析的所有样本，并按共享的调用栈和 ProfilerMarker 层级视图将样本一起分组。<strong>Raw Hierarchy</strong> 视图不会将样本一起分组，因此非常适合在粒度级别上查看样本。也可以使用 <strong>Thread</strong> 下拉选单来选择特定线程，例如要在这些视图中检查的主线程 (Main Thread) 或渲染线程 (Render Thread)。</p>

<p>默认情况下，在这些视图中，所有 EditorOnly 样本都是折叠状态。EditorOnly 样本是玩家循环 (Player Loop) 中仅由于“仅 Editor”安全性检查而发生的样本。样本折叠后，它们的 GC.Alloc 值不会影响所属样本的 GC.Alloc 值。要显示这些样本，请选择详细信息面板右上角的 <strong>More Items</strong> 菜单 (⋮)，然后禁用 <strong>Collapse EditorOnly Samples</strong> 设置。有关更多信息，请参阅本文档的<a href="#editor-only">仅 Editor 样本</a>部分。</p>

<p>这两个视图都会在 Hierarchy 中每行旁边显示有关每一项的以下详细信息：</p>

<table>
<colgroup>
<col style="text-align:left;">
<col style="text-align:left;">
</colgroup>

<thead>
<tr>
	<th style="text-align:left;"><strong>属性</strong></th>
	<th style="text-align:left;"><strong>功能</strong></th>
</tr>
</thead>

<tbody>
<tr>
	<td style="text-align:left;"><strong>Total</strong></td>
	<td style="text-align:left;">Unity 在特定函数上花费的总时间（以百分比表示）。</td>
</tr>
<tr>
	<td style="text-align:left;"><strong>Self</strong></td>
	<td style="text-align:left;">Unity 在特定函数上花费的总时间（以百分比表示），不包括 Unity 在调用子函数时花费的时间。<br> <br> 例如，在截屏中，16.7% 的时间用在了 <code>Camera.Render</code> 函数上。这是因为该函数调用了许多绘制和剔除函数。但是，排除调用的函数后，只有 0.2% 的时间花费在 <code>Camera.Render</code> 函数本身上。</td>
</tr>
<tr>
	<td style="text-align:left;"><strong>Calls</strong></td>
	<td style="text-align:left;">此帧中调用此函数的次数。在 <strong>Raw Hierarchy</strong> 视图中，此列中的值始终为 1，因为性能分析器不会合并样本的层级视图。</td>
</tr>
<tr>
	<td style="text-align:left;"><strong>GC Alloc</strong></td>
	<td style="text-align:left;">Unity 在当前帧中分配的脚本堆内存量。脚本堆内存由<a href="BestPracticeUnderstandingPerformanceInUnity4-1.html">垃圾回收器</a>管理。<br> <br> 每当 Unity 调用 <code>GC.Collect()</code> 或脚本堆分配大小超出堆的当前大小时，就会触发垃圾回收器。垃圾回收器会标记没有更多引用的所有分配并收集这些引用。此进程在性能分析器中显示为 <strong>GC.Collect</strong> 样本。<br> <br> 在堆上分配得越多，Unity 运行垃圾回收器就越频繁。随着托管的堆不断增长，Unity 需要花费更长的时间来标记和收集内存。因此，应在应用程序运行时将 <strong>GC Alloc</strong> 值保持为零，从而防止垃圾回收器影响帧率，并使整体堆大小保持较小值。<br> <br> 有关托管堆的更多详细信息，请参阅关于<a href="UnderstandingAutomaticMemoryManagement.html">了解自动内存管理</a>的文档。</td>
</tr>
<tr>
	<td style="text-align:left;"><strong>Time ms</strong></td>
	<td style="text-align:left;">Unity 在特定函数上花费的总时间（以毫秒为单位）。如果应用程序使用<a href="JobSystem.html">作业系统</a>或多线程渲染，则此信息可能会产生误导，因为它仅包含 Unity 在当前选定线程上花费的时间。要更改线程，请选择 Hierarchy 面板顶部的 <strong>Thread</strong> 下拉选单。</td>
</tr>
<tr>
	<td style="text-align:left;"><strong>Self ms</strong></td>
	<td style="text-align:left;">Unity 在特定函数上花费的总时间（以毫秒为单位），不包括 Unity 在调用子函数时花费的时间。</td>
</tr>
<tr>
	<td style="text-align:left;"><strong>Warning</strong></td>
	<td style="text-align:left;">由警告图标指示，此处显示应用程序在当前帧中触发警告的次数。有关更多信息，请参阅本文档的<a href="#warnings">性能警告</a>部分。</td>
</tr>
</tbody>
</table>

<p>要进一步了解应用程序在何处调用和使用了接受性能分析的函数，请选择模块详细信息面板右上角的 <strong>Details</strong> 下拉选单，然后选择 <strong>Related Data</strong> 或 <strong>Calls</strong> 视图。</p>

<figure>
<img src="../uploads/Main/profiler-show-related-objects.png" alt="Related Data 面板">
<figcaption><strong>Related Data</strong> 面板</figcaption>
</figure>

<p><strong>Related Data</strong> 视图显示一个 <code>UnityEngine.Objects</code> 列表；此列表中的对象使用 <a href="../ScriptReference/Unity.Profiling.ProfilerMarker.Begin.html">Begin()</a> 重载，而且与性能分析器样本关联。Unity 报告的某些样本内置了这些关联性，例如，已链接到执行渲染的摄像机游戏对象的 Camera.Render 样本。如果在 Editor 中进行性能分析，Unity 将通过这些对象的实例 ID 来报告这些对象，并在 Profiler 窗口中将它们解析为名称。对构建的播放器进行性能分析或从磁盘加载捕获的数据时，这些名称不会显示，并且性能分析器将这些名称显示为 <code>N/A</code>。</p>

<p>单击这些对象之一时，Unity 尝试通过 Scene 层级视图来查找此对象，然后对此对象进行 <a href="../ScriptReference/EditorGUIUtility.PingObject.html">ping</a> 操作。因为此关联性使用实例 ID，所以只有在 Editor 中对应用程序进行性能分析并且该对象仍然存在的情况下，ping 操作才有效。</p>

<p>对于 <code>GC.Alloc</code> 样本，此视图会显示 <code>N/A</code> 项的列表；在此层级视图级别发生的每个分配都有一个对应的项，并且会在 GC.Alloc 列中列出此分配的大小。如果在已启用 <strong>Call Stacks</strong> 设置的情况下对应用程序进行性能分析，则在此视图中选择 <code>GC.Alloc</code> 样本时，Profiler 窗口将显示选定的所分配脚本对象的调用栈（即使未启用 Deep Profiling 设置）。有关更多信息，请参阅本文档的<a href="#allocation-callstacks">分配调用栈</a>部分。</p>

<figure>
<img src="../uploads/Main/profiler-show-calls.png" alt="Show Calls 面板">
<figcaption>Show Calls 面板</figcaption>
</figure>

<p><strong>Show Calls</strong> 视图显示从何处调用所选样本以及这个样本调用的其他函数。</p>

<p><a name="call-stacks"></a></p>

<h2>调用栈</h2>

<p><a href="../ScriptReference/Unity.Profiling.ProfilerMarker.html">ProfilerMarkers</a> 发出一组样本，性能分析器使用这些样本将性能分析信息显示和组织到不同的时间顺序和层级视图中。因此，Profiler 窗口中显示的任何样本都是样本栈的一部分。</p>

<p>样本栈与方法的调用栈不同，因为 Unity 不会将每个样本都绑定到特定方法，也不会将每个调用都记录为样本。<a href="CPUWindow#deep-profiling">深度性能分析</a>为每个函数调用添加一个 ProfilerMarker，但它不会为本机代码添加任何内容，而且记录所有这些样本会带来潜在的较大开销。</p>

<p>您可以为 <strong>GC.Alloc</strong>、<strong>UnsafeUtility.Malloc</strong>、<strong>JobHandle.Complete</strong> 发出的样本启用完整的调用栈。如果您希望在不启用深度性能分析并避免较大开销的情况下跟踪这些样本的发生位置，这将非常有用。有关这些标记的更多信息，请参阅有关<a href="profiler-markers.html">常见性能分析器标记</a>的文档。</p>

<p>为此，请导航到 Profiler 窗口的工具栏，然后启用 <strong>Call Stacks</strong> 按钮。默认情况下，这会启用 <strong>GC.Alloc</strong> 样本的调用栈。要启用其他调用栈，请选择下拉箭头并启用您希望查看其调用栈的任何其他标记。</p>

<p>无论是在编辑器中还是在运行的播放器中进行性能分析，都可以使用此功能。此功能仅在您打开此选项后才会对进行性能分析的框架生效。</p>

<p>例如，每个脚本堆分配在 <strong>Hierarchy</strong> 视图和 <strong>Timeline</strong> 视图中均显示为 GC.Alloc 样本。在 Timeline 视图中，颜色为亮红色。要查看某个调用栈，请选择 CPU Profiler 模块，然后在 Timeline 视图中选择一个 GC.Alloc 样本。<strong>注意：</strong>调用栈信息不包含该方法中的确切行号，而仅包含该方法开头的行。</p>

<figure>
<img src="../uploads/Main/profiler-cpu-hierarchy-callstack.png" alt="Timeline 视图（顶部）和 Hierarchy 视图（底部）中的调用栈">
<figcaption>Timeline 视图（顶部）和 Hierarchy 视图（底部）中的调用栈</figcaption>
</figure>

<p>要查看完整的调用栈详细信息，请在 Hierarchy 或 Raw Hierarchy 视图中将 <strong>Details</strong> 视图设置为 <strong>Related Data</strong>。此视图列出了与此样本关联的元数据，其中可能包括与之相关联的 UnityEngine.Object。对于任何不与 UnityEngine.Object 关联的元数据条目，该名称在此面板中显示为 <strong>N/A</strong>。选择 N/A 条目时，性能分析器会在 Details 视图的下半部分中显示元数据，包括调用栈。</p>

<p>有关托管分配的更多信息，请参阅关于<a href="https://docs.unity3d.com/Manual/UnderstandingAutomaticMemoryManagement.html">了解自动内存管理</a>的文档。</p>

<p><a name="samples"></a></p>

<h2>常用标记</h2>

<p>Unity 的代码配备了大量性能分析器标记，可用于深入了解应用程序中占用时间的内容。有关您可能在性能分析数据中看到的最常见标记的完整列表，请参阅有关<a href="profiler-markers.html">常用性能分析器标记 </a>的文档。</p>
<div class="nextprev clear">
<div class="icon tt left mr1" data-distance="-40|-30|top">
<span class="prev"><a href="ProfilerAudio.html"></a></span><div class="tip">Audio Profiler 模块</div>
</div>
<div class="icon tt right" data-distance="-40|-30|top">
<span class="next"><a href="ProfilerGI.html"></a></span><div class="tip">Global Illumination Profiler 模块</div>
</div>
</div>
</div>
<div class="footer-wrapper">
<div class="footer clear">
<div class="copy">Copyright © 2021 Unity Technologies. Publication 2020.3</div>
<div class="menu">
<a href="https://learn.unity.com/">教程</a><a href="https://answers.unity3d.com">社区答案</a><a href="https://support.unity3d.com/hc/en-us">知识库</a><a href="https://forum.unity3d.com">论坛</a><a href="https://unity3d.com/asset-store">Asset Store</a>
</div>
</div>
<div></div>
</div>
</div></div></div>
</div>
</body>
</html>
