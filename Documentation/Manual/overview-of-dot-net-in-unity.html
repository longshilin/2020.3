<!DOCTYPE html><html class="no-js" lang="zh-cn">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
      new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
      })(window,document,'script','dataLayer','GTM-5V25JL6');
    </script><link href="https://fonts.googleapis.com/css?family=Roboto&amp;display=swap" rel="stylesheet">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="twitter:card" content="summary">
<meta property="og:title" content="Unity 中的 .NET 概述 - Unity 手册">
<title>Unity 中的 .NET 概述 - Unity 手册</title>
<meta property="og:image" content="https://docs.unity3d.com/cn/2020.3/uploads/Main/unity-engine-object.png">
<meta name="description" content="Unity 使用开源 .NET 平台，以确保使用 Unity 创建的应用程序可以在各种不同的硬件配置上运行。.NET 支持一系列语言和 API 库。">
<meta property="og:description" content="Unity 使用开源 .NET 平台，以确保使用 Unity 创建的应用程序可以在各种不同的硬件配置上运行。.NET 支持一系列语言和 API 库。">
<meta name="author" content="Unity Technologies">
<link rel="shortcut icon" href="https://unity.com/themes/contrib/unity_base/images/favicons/favicon.ico">
<link rel="icon" type="image/png" href="../StaticFiles/images/favicons/favicon.png">
<link rel="apple-touch-icon-precomposed" sizes="152x152" href="../StaticFiles/images/favicons/apple-touch-icon-152x152.png">
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="../StaticFiles/images/favicons/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon-precomposed" sizes="120x120" href="../StaticFiles/images/favicons/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="../StaticFiles/images/favicons/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="../StaticFiles/images/favicons/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon-precomposed" href="../StaticFiles/images/favicons/apple-touch-icon.png">
<meta name="msapplication-TileColor" content="#222c37">
<meta name="msapplication-TileImage" content="../StaticFiles/images/favicons/tileicon-144x144.png">
<script type="text/javascript" src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" charset="UTF-8" data-domain-script="6e91be4c-3145-4ea2-aa64-89d716064836"></script><script type="text/javascript">
        function OptanonWrapper() { }
    </script><script>
      var docs_type = 'Manual';
      var lang = 'cn';
      var page = 'overview-of-dot-net-in-unity';
      if(!page) page = 'index';
      var version = '2020.3';
      var docs_versions = [{version: '2021.1',version_string: '2021.1',supported: true},{version: '2020.3',version_string: '2020.3',supported: true},{version: '2020.2',version_string: '2020.2',supported: false},{version: '2020.1',version_string: '2020.1',supported: false},{version: '2019.4',version_string: '2019.4',supported: true},{version: '2019.3',version_string: '2019.3',supported: false},{version: '2019.2',version_string: '2019.2',supported: false},{version: '2019.1',version_string: '2019.1',supported: false},{version: '2018.4',version_string: '2018.4',supported: true},{version: '2018.3',version_string: '2018.3',supported: false},{version: '2018.2',version_string: '2018.2',supported: false},{version: '2018.1',version_string: '2018.1',supported: false},{version: '2017.4',version_string: '2017.4',supported: false},{version: '2017.3',version_string: '2017.3',supported: false},{version: '2017.2',version_string: '2017.2',supported: false},{version: '2017.1',version_string: '2017.1',supported: false},{version: '5.6',version_string: '560',supported: false},];</script><script type="text/javascript" src="../StaticFiles/js/jquery.js"></script><script type="text/javascript" src="../StaticFiles/js/core.js"></script><script type="text/javascript" src="../StaticFiles/js/jquery.sidebar.min.js"></script><script type="text/javascript" src="docdata/toc.js"></script><script type="text/javascript" src=""></script><script type="text/javascript" src="../StaticFiles/js/custom.js"></script><link rel="stylesheet" type="text/css" href="../StaticFiles/css/core.css">
<link rel="stylesheet" type="text/css" href="../StaticFiles/css/custom.css">
<link rel="canonical" href="https://docs.unity3d.com/cn/2020.3/Manual/overview-of-dot-net-in-unity.html">
<link rel="alternate" href="https://docs.unity3d.com/en/2020.3/Manual/overview-of-dot-net-in-unity.html" hreflang="en">
<link rel="alternate" href="https://docs.unity3d.com/cn/2020.3/Manual/overview-of-dot-net-in-unity.html" hreflang="zh">
<link rel="alternate" href="https://docs.unity3d.com/ja/2020.3/Manual/overview-of-dot-net-in-unity.html" hreflang="ja">
<link rel="alternate" href="https://docs.unity3d.com/es/2020.3/Manual/overview-of-dot-net-in-unity.html" hreflang="es">
<link rel="alternate" href="https://docs.unity3d.com/kr/2020.3/Manual/overview-of-dot-net-in-unity.html" hreflang="ko">
<link rel="alternate" href="https://docs.unity3d.com/ru/2020.3/Manual/overview-of-dot-net-in-unity.html" hreflang="ru">
<link rel="alternate" href="https://docs.unity3d.com/2020.3/Documentation/Manual/overview-of-dot-net-in-unity.html" hreflang="x-default">
</head>
<body>
<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5V25JL6" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<div class="header-wrapper">
<div id="header" class="header"><div class="content">
<div class="spacer"><div class="menu">
<div id="nav-open" for="nav-input"><span></span></div>
<div class="logo"><a href="./index.html"></a></div>
<div class="search-form"><form action="30_search.html" method="get" class="apisearch">
<input type="text" name="q" placeholder="搜索手册..." autosave="Unity Reference" results="5" class="sbox field" id="q"><input type="submit" class="submit">
</form></div>
<ul class="menu-items">
<li class="menu-item"><a href="../Manual/index.html" class="selected">手册</a></li>
<li class="menu-item"><a href="../ScriptReference/index.html" class="">脚本 API</a></li>
</ul>
</div></div>
<div class="more">
<div class="filler"></div>
<ul><li><a href="https://unity3d.com/">
                unity3d.com
              </a></li></ul>
</div>
</div></div>
<div class="toolbar"><div class="content">
<div class="version-switcher">
<div class="current toggle" data-target=".version-list"><div class="version-number">
<div class="d-inline-block">
          Version:
          <b>2020.3</b>
</div>
<div class="d-inline-block arrow"></div>
</div></div>
<div class="version-list" style="display:none;">
<ul class="versions">
<li class="supported"><a class="docs_version_url_2021.1" href="/cn/2021.1/Manual/overview-of-dot-net-in-unity.html">2021.1</a></li>
<li class="supported"><a class="docs_version_url_2020.3" href="/cn/2020.3/Manual/overview-of-dot-net-in-unity.html">2020.3</a></li>
<li class=""><a class="docs_version_url_2020.2" href="/cn/2020.2/Manual/overview-of-dot-net-in-unity.html">2020.2</a></li>
<li class=""><a class="docs_version_url_2020.1" href="/cn/2020.1/Manual/overview-of-dot-net-in-unity.html">2020.1</a></li>
<li class="supported"><a class="docs_version_url_2019.4" href="/cn/2019.4/Manual/overview-of-dot-net-in-unity.html">2019.4</a></li>
<li class=""><a class="docs_version_url_2019.3" href="/cn/2019.3/Manual/overview-of-dot-net-in-unity.html">2019.3</a></li>
<li class=""><a class="docs_version_url_2019.2" href="/cn/2019.2/Manual/overview-of-dot-net-in-unity.html">2019.2</a></li>
<li class=""><a class="docs_version_url_2019.1" href="/cn/2019.1/Manual/overview-of-dot-net-in-unity.html">2019.1</a></li>
<li class="supported"><a class="docs_version_url_2018.4" href="/cn/2018.4/Manual/overview-of-dot-net-in-unity.html">2018.4</a></li>
<li class=""><a class="docs_version_url_2018.3" href="/cn/2018.3/Manual/overview-of-dot-net-in-unity.html">2018.3</a></li>
<li class=""><a class="docs_version_url_2018.2" href="/cn/2018.2/Manual/overview-of-dot-net-in-unity.html">2018.2</a></li>
<li class=""><a class="docs_version_url_2018.1" href="/cn/2018.1/Manual/overview-of-dot-net-in-unity.html">2018.1</a></li>
<li class=""><a class="docs_version_url_2017.4" href="/cn/2017.4/Manual/overview-of-dot-net-in-unity.html">2017.4</a></li>
<li class=""><a class="docs_version_url_2017.3" href="/cn/2017.3/Manual/overview-of-dot-net-in-unity.html">2017.3</a></li>
<li class=""><a class="docs_version_url_2017.2" href="/cn/2017.2/Manual/overview-of-dot-net-in-unity.html">2017.2</a></li>
<li class=""><a class="docs_version_url_2017.1" href="/cn/2017.1/Manual/overview-of-dot-net-in-unity.html">2017.1</a></li>
<li class=""><a class="docs_version_url_560" href="/cn/560/Manual/overview-of-dot-net-in-unity.html">5.6</a></li>
<div class="versionsWithThisPage" style="display:none;"><li><p>包含此页的版本：</p></li></div>
<div class="versionsWithoutThisPage" style="display:none;"><li><p>不含此页的版本：</p></li></div>
</ul>
<ul class="description">
<li>
<div class="supported-box"></div>受支持</li>
<li>
<div class="legacy-box"></div>旧版</li>
</ul>
</div>
</div>
<ul class="nav-menu-items">
<li class="menu-item"><a href="../Manual/index.html" class="selected">手册</a></li>
<li class="menu-item"><a href="../ScriptReference/index.html" class="">脚本 API</a></li>
</ul>
<div class="lang-switcher">
<div class="current toggle" data-target=".lang-list">
<div class="lbl">语言:
        <span class="b">中文</span>
</div>
<div class="arrow"></div>
</div>
<div class="lang-list" style="display:none;"><ul>
<li><a data-lang="en" href="/2020.3/Documentation/Manual/overview-of-dot-net-in-unity.html">English</a></li>
<li><a data-lang="cn" href="/cn/2020.3/Manual/overview-of-dot-net-in-unity.html">中文</a></li>
<li><a data-lang="ja" href="/ja/2020.3/Manual/overview-of-dot-net-in-unity.html">日本語</a></li>
<li><a data-lang="es" href="/es/2020.3/Manual/overview-of-dot-net-in-unity.html">Español</a></li>
<li><a data-lang="kr" href="/kr/2020.3/Manual/overview-of-dot-net-in-unity.html">한국어</a></li>
<li><a data-lang="ru" href="/ru/2020.3/Manual/overview-of-dot-net-in-unity.html">Русский</a></li>
</ul></div>
</div>
</div></div>
</div>
<div id="master-wrapper" class="master-wrapper clear">
<div id="sidebar" class="sidebar hidden"><div class="sidebar-wrap"><div class="content"><div class="sidebar-menu"><div class="toc">
<h2>手册</h2>
<div class="version-switcher">
<div class="current toggle" data-target=".version-list"><div class="version-number">
<div class="d-inline-block">
          Version:
          <b>2020.3</b>
</div>
<div class="d-inline-block arrow"></div>
</div></div>
<div class="version-list" style="display:none;">
<ul class="versions">
<li class="supported"><a class="docs_version_url_2021.1" href="/cn/2021.1/Manual/overview-of-dot-net-in-unity.html">2021.1</a></li>
<li class="supported"><a class="docs_version_url_2020.3" href="/cn/2020.3/Manual/overview-of-dot-net-in-unity.html">2020.3</a></li>
<li class=""><a class="docs_version_url_2020.2" href="/cn/2020.2/Manual/overview-of-dot-net-in-unity.html">2020.2</a></li>
<li class=""><a class="docs_version_url_2020.1" href="/cn/2020.1/Manual/overview-of-dot-net-in-unity.html">2020.1</a></li>
<li class="supported"><a class="docs_version_url_2019.4" href="/cn/2019.4/Manual/overview-of-dot-net-in-unity.html">2019.4</a></li>
<li class=""><a class="docs_version_url_2019.3" href="/cn/2019.3/Manual/overview-of-dot-net-in-unity.html">2019.3</a></li>
<li class=""><a class="docs_version_url_2019.2" href="/cn/2019.2/Manual/overview-of-dot-net-in-unity.html">2019.2</a></li>
<li class=""><a class="docs_version_url_2019.1" href="/cn/2019.1/Manual/overview-of-dot-net-in-unity.html">2019.1</a></li>
<li class="supported"><a class="docs_version_url_2018.4" href="/cn/2018.4/Manual/overview-of-dot-net-in-unity.html">2018.4</a></li>
<li class=""><a class="docs_version_url_2018.3" href="/cn/2018.3/Manual/overview-of-dot-net-in-unity.html">2018.3</a></li>
<li class=""><a class="docs_version_url_2018.2" href="/cn/2018.2/Manual/overview-of-dot-net-in-unity.html">2018.2</a></li>
<li class=""><a class="docs_version_url_2018.1" href="/cn/2018.1/Manual/overview-of-dot-net-in-unity.html">2018.1</a></li>
<li class=""><a class="docs_version_url_2017.4" href="/cn/2017.4/Manual/overview-of-dot-net-in-unity.html">2017.4</a></li>
<li class=""><a class="docs_version_url_2017.3" href="/cn/2017.3/Manual/overview-of-dot-net-in-unity.html">2017.3</a></li>
<li class=""><a class="docs_version_url_2017.2" href="/cn/2017.2/Manual/overview-of-dot-net-in-unity.html">2017.2</a></li>
<li class=""><a class="docs_version_url_2017.1" href="/cn/2017.1/Manual/overview-of-dot-net-in-unity.html">2017.1</a></li>
<li class=""><a class="docs_version_url_560" href="/cn/560/Manual/overview-of-dot-net-in-unity.html">5.6</a></li>
<div class="versionsWithThisPage" style="display:none;"><li><p>包含此页的版本：</p></li></div>
<div class="versionsWithoutThisPage" style="display:none;"><li><p>不含此页的版本：</p></li></div>
</ul>
<ul class="description">
<li>
<div class="supported-box"></div>受支持</li>
<li>
<div class="legacy-box"></div>旧版</li>
</ul>
</div>
</div>
<div class="clear"></div>
</div></div></div></div></div>
<div id="content-wrap" class="content-wrap opened-sidebar"><div class="content-block"><div class="content">
<div class="section">
<div class="breadcrumbs clear"><ul>
<li><a href="UnityManual.html">Unity 用户手册 2020.3 (LTS)</a></li>
<li><a href="ScriptingSection.html">脚本</a></li>
<li><a href="unity-architecture.html">Unity 架构</a></li>
<li>Unity 中的 .NET 概述</li>
</ul></div>
<div class="mb20"><div class="nextprev clear">
<div class="icon tt left mr1" data-distance="-40|-30|top">
<span class="prev"><a href="unity-architecture.html"></a></span><div class="tip">Unity 架构</div>
</div>
<div class="icon tt right" data-distance="-40|-30|top">
<span class="next"><a href="dotnetProfileSupport.html"></a></span><div class="tip">.NET 配置文件支持</div>
</div>
</div></div>
<h1>Unity 中的 .NET 概述</h1>
<!--BeginSwitchLink--><!--EndSwitchLink-->
<div class="clear"></div>

<p>Unity 使用开源 .NET 平台，以确保使用 Unity 创建的应用程序可以在各种不同的硬件配置上运行。.NET 支持一系列语言和 API 库。</p>

<h2>脚本后端</h2>

<p>Unity 具有两个脚本后端 Mono 和 <a href="IL2CPP.html">IL2CPP</a> (Intermediate Language To C++)，它们各自使用不同的编译技术：</p>

<ul>
<li>Mono 使用即时 (JIT) 编译，在运行时按需编译代码。</li>
<li>IL2CPP 使用提前 (AOT) 编译，在运行之前编译整个应用程序。</li>
</ul>

<p>使用基于 JIT 的脚本后端的好处是编译时间通常比 AOT 快得多，而且它与平台无关。</p>

<p>Unity 编辑器基于 JIT，使用 Mono 作为脚本后端。为应用程序生成播放器时，可以选择要使用的脚本后端。要通过编辑器执行此操作，请转到 <strong>Edit &gt; Project Settings &gt; Player</strong>，打开 <strong>Other Settings</strong> 面板，然后单击 <strong>Scripting Backend</strong> 下拉列表并选择所需后端。</p>

<h2>托管代码剥离</h2>

<p>生成应用程序时，Unity 会扫描已编译的程序集 (.DLL) 以检测并移除未使用的代码。此过程会减少生成的最终二进制文件大小，但会增加生成时间。</p>

<p>使用 Mono 时，在默认情况下会禁用代码剥离，但无法为 IL2CPP 禁用代码剥离。可以控制 Unity 在剥离代码时的激进程度。转到 <strong>Edit &gt; Project Settings &gt; Player</strong>，打开 <strong>Other Settings</strong> 面板，然后单击 <strong>Managed Stripping Level</strong> 下拉列表并选择所需的代码剥离级别。有关代码剥离的更多信息，请参阅<a href="ManagedCodeStripping.html">托管代码剥离</a>文档。</p>

<blockquote>
<p><strong>注意：</strong>代码剥离在某些情况下可能过于激进，可能会移除所依赖的代码，尤其是在使用反射时。可以使用 <strong>Preserve</strong> 属性和 link.xml 文件来防止剥离特定类型和函数。</p>
</blockquote>

<h2>垃圾收集</h2>

<p>Unity 将 <a href="https://en.wikipedia.org/wiki/Boehm_garbage_collector">Boehm 垃圾回收器</a>用于 Mono 和 IL2CPP 后端。Unity 在默认情况下使用<strong>增量</strong>模式。可以禁用<strong>增量</strong>模式以使用“可停止所有工作”的垃圾收集，不过 Unity 建议使用<strong>增量</strong>模式。</p>

<p>要在增量模式与“可停止所有工作”之间切换，请转到 <strong>Edit &gt; Project Settings &gt; Player</strong>，打开 <strong>Other Settings</strong> 面板并单击 <strong>Use incremental GC</strong> 复选框。在增量模式下，Unity 的垃圾回收器只会运行一段有限的时间，并不一定会收集一个通道中的所有对象。这会将收集对象所需的时间分散在多个帧间，并减少卡顿和 CPU 峰值的数量。有关更多信息，请参阅<a href="UnderstandingAutomaticMemoryManagement.html">了解自动内存管理</a>。</p>

<p>要检查应用程序中的分配和可能 CPU 峰值的数量，请使用 <a href="Profiler.html">Unity 性能分析器</a>。还可以使用 <a href="../ScriptReference/Scripting.GarbageCollector.html">GarbageCollector</a> API 在播放器中完全禁用垃圾收集。禁用回收器后，应该小心避免分配过多的内存。</p>

<h2>.NET 系统库</h2>

<p>Unity 支持许多平台，可能会根据平台使用不同的脚本后端。在某些情况下，.NET 系统库需要特定于平台的实现才能正常工作。尽管 Unity 尽最大努力支持尽可能多的 .NET 生态系统，但对于 Unity 明确不支持的部分 .NET 系统库，也有一些例外。</p>

<p>Unity 不保证 .NET 系统库在 Unity 版本间的性能和分配。作为一般经验法则，Unity 不会修复 .NET 系统库中的任何性能退化。</p>

<p>Unity 不支持 <code>System.Drawing</code> 库，并且不保证在所有平台上都正常工作。</p>

<p>JIT 脚本后端允许在应用程序运行时发出动态 C#/.NET 中间语言 (IL) 代码生成，而 AOT 脚本后端不支持动态代码生成。使用第三方库时考虑到这一点十分重要，因为它们对于 JIT 和 AOT 可能具有不同的代码路径，或者它们可能会使用依赖于动态生成代码的代码路径。有关如何在运行时生成代码的更多信息，请参阅 Microsoft 的 <a href="https://docs.microsoft.com/en-us/dotnet/api/system.reflection.emit.modulebuilder?view=netcore-3.1">ModuleBuilder</a> 文档。</p>

<p>尽管 Unity 支持多个 .NET API 配置文件，不过应该对于所有新项目都使用 .NET Standard 2.0 <a href="../ScriptReference/ApiCompatibilityLevel.html">API 兼容性级别</a>，原因如下：</p>

<ul>
<li>.NET Standard 2.0 是较小的 API 表面，因此具有较小的实现。这会减小最终可执行文件的大小。</li>
<li>.NET Standard 2.0 具有更好的跨平台支持，因此代码更有可能跨所有平台正常工作。</li>
<li>.NET Standard 2.0 受所有 .NET 运行时支持，因此代码可以跨更多 VM/运行时环境（例如 .NET Framework、.NET Core、Xamarin、Unity）正常工作。</li>
<li>.NET Standard 将更多错误移至编译时。.NET 4.7.1 中的一些 API 可在编译时使用，但在某些平台上的实现会在运行时抛出异常。</li>
</ul>

<p>例如，如果需要为较旧的现有应用程序提供支持，则其他配置文件可能会很有用。如果需要不同的 API 兼容性级别，请在 Player Settings 中更改 <strong>.NET Profile</strong>。要执行此操作，请转到 <strong>Edit &gt; Project Settings &gt; Player &gt; Other Settings</strong>，然后从 <strong>Api Compatibility Level</strong> 下拉菜单中选择所需级别。</p>

<h2>使用第三方 .NET 库</h2>

<p>应该只使用在各种 Unity 配置和平台上经过广泛测试的第三方 .NET 库。</p>

<blockquote>
<p><strong>注意：</strong>第三方库中 JIT 和 AOT 代码路径的性能特征可能会显著不同。AOT 通常会减少启动时间，因此适用于较大的应用程序，但会增加二进制文件大小以容纳已编译代码。AOT 在开发过程中也需要较长时间进行生成，无法更改已编译代码的行为以针对任何特定平台。JIT 在运行时会基于它运行的平台进行调整，这可以提高运行性能，但代价是可能会延长应用程序启动时间。因此，应该在编辑器和目标平台上对应用程序进行性能分析。有关更多信息，请参阅 Unity <a href="Profiler.html">性能分析器</a>文档。</p>
</blockquote>

<p>应该在所有目标平台上对 .NET 系统库的使用情况进行性能分析，因为其性能特征可能会因所使用的脚本后端、.NET 版本和配置文件而异。</p>

<p>查看第三方库时，请考虑以下方面：</p>

<ul>
<li>兼容性：第三方库可能与某些 Unity 平台和脚本后端不兼容。</li>
<li>性能：与其他 .NET 运行时相比，第三方库在 Unity 中可能具有截然不同的性能特征。</li>
<li>AOT 二进制文件大小：由于库使用的依赖项数量，第三方库可能会显著增大 AOT 二进制文件大小。</li>
</ul>

<h2>C# 反射开销</h2>

<p>Mono 和 IL2CPP 会在内部缓存所有 C# 反射 (<code>System.Reflection</code>) 对象，并且按照设计，Unity 不会对它们进行垃圾收集。此行为的结果是垃圾回收器在应用程序生命周期内持续扫描缓存的 C# 反射对象，这会导致不必要和潜在的大量垃圾回收器开销。</p>

<p>要最大程度减少垃圾回收器开销，请在应用程序中避免使用诸如 <a href="https://docs.microsoft.com/en-us/dotnet/api/system.reflection.assembly.gettypes">Assembly.GetTypes</a> 和 <a href="https://docs.microsoft.com/en-us/dotnet/api/system.type.getmethods">Type.GetMethods()</a> 等方法，这些方法会在运行时创建许多 C# 反射对象。而是应该在编辑器中扫描程序集以获取所需数据，并进行序列化和/或代码生成以在运行时使用。</p>

<p><a name="UnityEngineObject"></a></p>

<h2>UnityEngine.Object 特殊行为</h2>

<p><a href="class-Object.html">UnityEngine.Object</a> 是 Unity 中的一种特殊类型的 C# 对象，因为它链接到原生 C++ 对应对象。例如，使用 <a href="../ScriptReference/Camera.html">Camera</a> 组件时，Unity 不会将对象的状态存储在 C# 对象中，而是存储在其原生 C++ 对应对象中。</p>

<figure>
<img src="../uploads/Main/unity-engine-object.png" alt="">
</figure>

<p>Unity 目前不支持将 C# WeakReference 类与 UnityEngine.Object 一起使用。因此，不应使用 WeakReference 引用加载的资源。有关 WeakReference 类的更多信息，请参阅 Microsoft 的 <a href="https://docs.microsoft.com/en-us/dotnet/api/system.weakreference?view=netcore-3.1">WeakReference 文档</a>。</p>

<h3>Unity C# 和 Unity C++ 共享 UnityEngine 对象</h3>

<p>使用诸如 <a href="../ScriptReference/Object.Destroy.html">Object.Destroy</a> 或 <a href="../ScriptReference/Object.DestroyImmediate.html">Object.DestroyImmediate</a> 等方法销毁 UnityEngine.Object 派生对象时，Unity 会销毁（卸载）原生对应对象。无法使用显式调用销毁 C# 对象，因为垃圾回收器会管理内存。一旦不再引用托管对象，垃圾回收器便会收集并销毁它。</p>

<p>如果再次访问已销毁的 `UnityEngine.Object，则 Unity 会为大多数类型重新创建原生对应对象。此重新创建行为的两个例外是 <a href="../ScriptReference/MonoBehaviour.html">MonoBehaviour</a> 和 <a href="ScriptableObject">ScriptableObject</a>：一旦被销毁，Unity 便绝不会重新加载它们。</p>

<p>MonoBehaviour 和 ScriptableObject 会覆盖相等 (<code>==</code>) 和不相等 (<code>!=</code>) 运算符。因此，如果将销毁的 MonoBehaviour 或 ScriptableObject 与 null 进行比较，则当托管对象仍然存在且尚未进行垃圾收集时，运算符会返回 true。</p>

<p>因为 <code>??</code> 和 <code>?.</code> 运算符不可重载，所以它们与从 <code>UnityEngine.Object</code> 派生的对象不兼容。在托管对象仍然存在的情况下对销毁的 MonoBehaviour 或 ScriptableObject 进行使用时，这些运算符不会返回与相等和不相等运算符相同的结果。</p>

<h2>避免使用异步和等待</h2>

<p>Unity API 不具有线程安全性，因此不应使用异步和等待任务。异步任务通常在调用时分配对象，这在过度使用它们时可能会导致性能问题。此外，退出运行模式时，Unity 不会自动停止在托管线程上运行的异步任务。</p>

<p>Unity 会使用自定义 <a href="https://github.com/Unity-Technologies/UnityCsReference/blob/master/Runtime/Export/Scripting/UnitySynchronizationContext.cs">UnitySynchronizationContext</a> 覆盖默认 <a href="https://docs.microsoft.com/en-us/archive/msdn-magazine/2011/february/msdn-magazine-parallel-computing-it-s-all-about-the-synchronizationcontext">SynchronizationContext</a>，在<strong>编辑</strong>和<strong>播放</strong>模式下对主线程运行所有任务。要使用异步任务，必须使用 <a href="https://docs.microsoft.com/en-us/dotnet/api/system.threading.tasks.taskfactory?view=netcore-3.1">TaskFactory</a> 手动创建和处理自己的线程，以及使用默认 SynchronizationContext 而不是 Unity 版本。要监听进入和退出运行模式事件以手动停止任务，请使用 <a href="../ScriptReference/EditorApplication.playModeStateChanged.html">EditorApplication.playModeStateChanged</a>。但是，如果采用这种方法，则大多数 Unity 脚本 API 都无法使用，因为未使用 UnitySynchronizationContext。</p>
<div class="nextprev clear">
<div class="icon tt left mr1" data-distance="-40|-30|top">
<span class="prev"><a href="unity-architecture.html"></a></span><div class="tip">Unity 架构</div>
</div>
<div class="icon tt right" data-distance="-40|-30|top">
<span class="next"><a href="dotnetProfileSupport.html"></a></span><div class="tip">.NET 配置文件支持</div>
</div>
</div>
</div>
<div class="footer-wrapper">
<div class="footer clear">
<div class="copy">Copyright © 2021 Unity Technologies. Publication 2020.3</div>
<div class="menu">
<a href="https://learn.unity.com/">教程</a><a href="https://answers.unity3d.com">社区答案</a><a href="https://support.unity3d.com/hc/en-us">知识库</a><a href="https://forum.unity3d.com">论坛</a><a href="https://unity3d.com/asset-store">Asset Store</a>
</div>
</div>
<div></div>
</div>
</div></div></div>
</div>
</body>
</html>
