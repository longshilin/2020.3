<!DOCTYPE html><html class="no-js" lang="zh-cn">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
      new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
      })(window,document,'script','dataLayer','GTM-5V25JL6');
    </script><link href="https://fonts.googleapis.com/css?family=Roboto&amp;display=swap" rel="stylesheet">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="twitter:card" content="summary">
<meta property="og:title" content="XR SDK Stats interface - Unity 手册">
<title>XR SDK Stats interface - Unity 手册</title>
<meta name="description" content="The XR SDK Stats interface is used for registering and managing statistics data.">
<meta property="og:description" content="The XR SDK Stats interface is used for registering and managing statistics data.">
<meta name="author" content="Unity Technologies">
<link rel="shortcut icon" href="https://unity.com/themes/contrib/unity_base/images/favicons/favicon.ico">
<link rel="icon" type="image/png" href="../StaticFiles/images/favicons/favicon.png">
<link rel="apple-touch-icon-precomposed" sizes="152x152" href="../StaticFiles/images/favicons/apple-touch-icon-152x152.png">
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="../StaticFiles/images/favicons/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon-precomposed" sizes="120x120" href="../StaticFiles/images/favicons/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="../StaticFiles/images/favicons/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="../StaticFiles/images/favicons/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon-precomposed" href="../StaticFiles/images/favicons/apple-touch-icon.png">
<meta name="msapplication-TileColor" content="#222c37">
<meta name="msapplication-TileImage" content="../StaticFiles/images/favicons/tileicon-144x144.png">
<script type="text/javascript" src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" charset="UTF-8" data-domain-script="6e91be4c-3145-4ea2-aa64-89d716064836"></script><script type="text/javascript">
        function OptanonWrapper() { }
    </script><script>
      var docs_type = 'Manual';
      var lang = 'cn';
      var page = 'xrsdk-stats';
      if(!page) page = 'index';
      var version = '2020.3';
      var docs_versions = [{version: '2021.1',version_string: '2021.1',supported: true},{version: '2020.3',version_string: '2020.3',supported: true},{version: '2020.2',version_string: '2020.2',supported: false},{version: '2020.1',version_string: '2020.1',supported: false},{version: '2019.4',version_string: '2019.4',supported: true},{version: '2019.3',version_string: '2019.3',supported: false},{version: '2019.2',version_string: '2019.2',supported: false},{version: '2019.1',version_string: '2019.1',supported: false},{version: '2018.4',version_string: '2018.4',supported: true},{version: '2018.3',version_string: '2018.3',supported: false},{version: '2018.2',version_string: '2018.2',supported: false},{version: '2018.1',version_string: '2018.1',supported: false},{version: '2017.4',version_string: '2017.4',supported: false},{version: '2017.3',version_string: '2017.3',supported: false},{version: '2017.2',version_string: '2017.2',supported: false},{version: '2017.1',version_string: '2017.1',supported: false},{version: '5.6',version_string: '560',supported: false},];</script><script type="text/javascript" src="../StaticFiles/js/jquery.js"></script><script type="text/javascript" src="../StaticFiles/js/core.js"></script><script type="text/javascript" src="../StaticFiles/js/jquery.sidebar.min.js"></script><script type="text/javascript" src="docdata/toc.js"></script><script type="text/javascript" src=""></script><script type="text/javascript" src="../StaticFiles/js/custom.js"></script><link rel="stylesheet" type="text/css" href="../StaticFiles/css/core.css">
<link rel="stylesheet" type="text/css" href="../StaticFiles/css/custom.css">
<link rel="canonical" href="https://docs.unity3d.com/cn/2020.3/Manual/xrsdk-stats.html">
<link rel="alternate" href="https://docs.unity3d.com/en/2020.3/Manual/xrsdk-stats.html" hreflang="en">
<link rel="alternate" href="https://docs.unity3d.com/cn/2020.3/Manual/xrsdk-stats.html" hreflang="zh">
<link rel="alternate" href="https://docs.unity3d.com/ja/2020.3/Manual/xrsdk-stats.html" hreflang="ja">
<link rel="alternate" href="https://docs.unity3d.com/es/2020.3/Manual/xrsdk-stats.html" hreflang="es">
<link rel="alternate" href="https://docs.unity3d.com/kr/2020.3/Manual/xrsdk-stats.html" hreflang="ko">
<link rel="alternate" href="https://docs.unity3d.com/ru/2020.3/Manual/xrsdk-stats.html" hreflang="ru">
<link rel="alternate" href="https://docs.unity3d.com/2020.3/Documentation/Manual/xrsdk-stats.html" hreflang="x-default">
</head>
<body>
<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5V25JL6" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<div class="header-wrapper">
<div id="header" class="header"><div class="content">
<div class="spacer"><div class="menu">
<div id="nav-open" for="nav-input"><span></span></div>
<div class="logo"><a href="./index.html"></a></div>
<div class="search-form"><form action="30_search.html" method="get" class="apisearch">
<input type="text" name="q" placeholder="搜索手册..." autosave="Unity Reference" results="5" class="sbox field" id="q"><input type="submit" class="submit">
</form></div>
<ul class="menu-items">
<li class="menu-item"><a href="../Manual/index.html" class="selected">手册</a></li>
<li class="menu-item"><a href="../ScriptReference/index.html" class="">脚本 API</a></li>
</ul>
</div></div>
<div class="more">
<div class="filler"></div>
<ul><li><a href="https://unity3d.com/">
                unity3d.com
              </a></li></ul>
</div>
</div></div>
<div class="toolbar"><div class="content">
<div class="version-switcher">
<div class="current toggle" data-target=".version-list"><div class="version-number">
<div class="d-inline-block">
          Version:
          <b>2020.3</b>
</div>
<div class="d-inline-block arrow"></div>
</div></div>
<div class="version-list" style="display:none;">
<ul class="versions">
<li class="supported"><a class="docs_version_url_2021.1" href="/cn/2021.1/Manual/xrsdk-stats.html">2021.1</a></li>
<li class="supported"><a class="docs_version_url_2020.3" href="/cn/2020.3/Manual/xrsdk-stats.html">2020.3</a></li>
<li class=""><a class="docs_version_url_2020.2" href="/cn/2020.2/Manual/xrsdk-stats.html">2020.2</a></li>
<li class=""><a class="docs_version_url_2020.1" href="/cn/2020.1/Manual/xrsdk-stats.html">2020.1</a></li>
<li class="supported"><a class="docs_version_url_2019.4" href="/cn/2019.4/Manual/xrsdk-stats.html">2019.4</a></li>
<li class=""><a class="docs_version_url_2019.3" href="/cn/2019.3/Manual/xrsdk-stats.html">2019.3</a></li>
<li class=""><a class="docs_version_url_2019.2" href="/cn/2019.2/Manual/xrsdk-stats.html">2019.2</a></li>
<li class=""><a class="docs_version_url_2019.1" href="/cn/2019.1/Manual/xrsdk-stats.html">2019.1</a></li>
<li class="supported"><a class="docs_version_url_2018.4" href="/cn/2018.4/Manual/xrsdk-stats.html">2018.4</a></li>
<li class=""><a class="docs_version_url_2018.3" href="/cn/2018.3/Manual/xrsdk-stats.html">2018.3</a></li>
<li class=""><a class="docs_version_url_2018.2" href="/cn/2018.2/Manual/xrsdk-stats.html">2018.2</a></li>
<li class=""><a class="docs_version_url_2018.1" href="/cn/2018.1/Manual/xrsdk-stats.html">2018.1</a></li>
<li class=""><a class="docs_version_url_2017.4" href="/cn/2017.4/Manual/xrsdk-stats.html">2017.4</a></li>
<li class=""><a class="docs_version_url_2017.3" href="/cn/2017.3/Manual/xrsdk-stats.html">2017.3</a></li>
<li class=""><a class="docs_version_url_2017.2" href="/cn/2017.2/Manual/xrsdk-stats.html">2017.2</a></li>
<li class=""><a class="docs_version_url_2017.1" href="/cn/2017.1/Manual/xrsdk-stats.html">2017.1</a></li>
<li class=""><a class="docs_version_url_560" href="/cn/560/Manual/xrsdk-stats.html">5.6</a></li>
<div class="versionsWithThisPage" style="display:none;"><li><p>包含此页的版本：</p></li></div>
<div class="versionsWithoutThisPage" style="display:none;"><li><p>不含此页的版本：</p></li></div>
</ul>
<ul class="description">
<li>
<div class="supported-box"></div>受支持</li>
<li>
<div class="legacy-box"></div>旧版</li>
</ul>
</div>
</div>
<ul class="nav-menu-items">
<li class="menu-item"><a href="../Manual/index.html" class="selected">手册</a></li>
<li class="menu-item"><a href="../ScriptReference/index.html" class="">脚本 API</a></li>
</ul>
<div class="lang-switcher">
<div class="current toggle" data-target=".lang-list">
<div class="lbl">语言:
        <span class="b">中文</span>
</div>
<div class="arrow"></div>
</div>
<div class="lang-list" style="display:none;"><ul>
<li><a data-lang="en" href="/2020.3/Documentation/Manual/xrsdk-stats.html">English</a></li>
<li><a data-lang="cn" href="/cn/2020.3/Manual/xrsdk-stats.html">中文</a></li>
<li><a data-lang="ja" href="/ja/2020.3/Manual/xrsdk-stats.html">日本語</a></li>
<li><a data-lang="es" href="/es/2020.3/Manual/xrsdk-stats.html">Español</a></li>
<li><a data-lang="kr" href="/kr/2020.3/Manual/xrsdk-stats.html">한국어</a></li>
<li><a data-lang="ru" href="/ru/2020.3/Manual/xrsdk-stats.html">Русский</a></li>
</ul></div>
</div>
</div></div>
</div>
<div id="master-wrapper" class="master-wrapper clear">
<div id="sidebar" class="sidebar hidden"><div class="sidebar-wrap"><div class="content"><div class="sidebar-menu"><div class="toc">
<h2>手册</h2>
<div class="version-switcher">
<div class="current toggle" data-target=".version-list"><div class="version-number">
<div class="d-inline-block">
          Version:
          <b>2020.3</b>
</div>
<div class="d-inline-block arrow"></div>
</div></div>
<div class="version-list" style="display:none;">
<ul class="versions">
<li class="supported"><a class="docs_version_url_2021.1" href="/cn/2021.1/Manual/xrsdk-stats.html">2021.1</a></li>
<li class="supported"><a class="docs_version_url_2020.3" href="/cn/2020.3/Manual/xrsdk-stats.html">2020.3</a></li>
<li class=""><a class="docs_version_url_2020.2" href="/cn/2020.2/Manual/xrsdk-stats.html">2020.2</a></li>
<li class=""><a class="docs_version_url_2020.1" href="/cn/2020.1/Manual/xrsdk-stats.html">2020.1</a></li>
<li class="supported"><a class="docs_version_url_2019.4" href="/cn/2019.4/Manual/xrsdk-stats.html">2019.4</a></li>
<li class=""><a class="docs_version_url_2019.3" href="/cn/2019.3/Manual/xrsdk-stats.html">2019.3</a></li>
<li class=""><a class="docs_version_url_2019.2" href="/cn/2019.2/Manual/xrsdk-stats.html">2019.2</a></li>
<li class=""><a class="docs_version_url_2019.1" href="/cn/2019.1/Manual/xrsdk-stats.html">2019.1</a></li>
<li class="supported"><a class="docs_version_url_2018.4" href="/cn/2018.4/Manual/xrsdk-stats.html">2018.4</a></li>
<li class=""><a class="docs_version_url_2018.3" href="/cn/2018.3/Manual/xrsdk-stats.html">2018.3</a></li>
<li class=""><a class="docs_version_url_2018.2" href="/cn/2018.2/Manual/xrsdk-stats.html">2018.2</a></li>
<li class=""><a class="docs_version_url_2018.1" href="/cn/2018.1/Manual/xrsdk-stats.html">2018.1</a></li>
<li class=""><a class="docs_version_url_2017.4" href="/cn/2017.4/Manual/xrsdk-stats.html">2017.4</a></li>
<li class=""><a class="docs_version_url_2017.3" href="/cn/2017.3/Manual/xrsdk-stats.html">2017.3</a></li>
<li class=""><a class="docs_version_url_2017.2" href="/cn/2017.2/Manual/xrsdk-stats.html">2017.2</a></li>
<li class=""><a class="docs_version_url_2017.1" href="/cn/2017.1/Manual/xrsdk-stats.html">2017.1</a></li>
<li class=""><a class="docs_version_url_560" href="/cn/560/Manual/xrsdk-stats.html">5.6</a></li>
<div class="versionsWithThisPage" style="display:none;"><li><p>包含此页的版本：</p></li></div>
<div class="versionsWithoutThisPage" style="display:none;"><li><p>不含此页的版本：</p></li></div>
</ul>
<ul class="description">
<li>
<div class="supported-box"></div>受支持</li>
<li>
<div class="legacy-box"></div>旧版</li>
</ul>
</div>
</div>
<div class="clear"></div>
</div></div></div></div></div>
<div id="content-wrap" class="content-wrap opened-sidebar"><div class="content-block"><div class="content">
<div class="section">
<div class="breadcrumbs clear"><ul>
<li><a href="UnityManual.html">Unity 用户手册 2020.3 (LTS)</a></li>
<li><a href="XR.html">XR</a></li>
<li><a href="xr-sdk.html">Unity XR SDK</a></li>
<li>Interfaces</li>
<li>XR SDK Stats interface</li>
</ul></div>
<div class="mb20"><div class="nextprev clear">
<div class="icon tt left mr1" data-distance="-40|-30|top">
<span class="prev"><a href="xrsdk-pre-init-interface.html"></a></span><div class="tip">XR SDK PreInit interface</div>
</div>
<div class="icon tt right" data-distance="-40|-30|top">
<span class="next"><a href="OpenSourceRepositories.html"></a></span><div class="tip">开源代码仓库</div>
</div>
</div></div>
<h1>XR SDK Stats interface</h1>
<!--BeginSwitchLink--><!--EndSwitchLink-->
<div class="clear"></div>

<p>The XR SDK Stats interface is used for registering and managing statistics data.</p>

<h2>概述</h2>

<p>Use the XR Stats interface to record stats among the various subsystems. The only supported stat primitive is a floating point number.</p>

<p>Use the <code>UnityPluginLoad</code> entry point method to acquire a pointer to the XRStats interface:</p>

<pre><code class="cpp">IUnityXRStats* sXRStats = nullptr;

extern "C" void UNITY_INTERFACE_EXPORT UnityPluginLoad(IUnityInterfaces* unityInterfaces)
{
    sXRStats = (IUnityXRStats*)unityInterfaces-&gt;GetInterface(UNITY_GET_INTERFACE_GUID(IUnityXRStats));
    //...
}
</code></pre>

<h2>用法</h2>

<p>Register your subsystem and individual stat definitions with the stats interface:</p>

<pre><code class="cpp">static UnityXRStatId m_GPUFrameTimeID;
static UnityXRStatId m_DroppedFrameCountID;
static UnityXRStatId m_WorkThreadStat;

static UnitySubsystemErrorCode ExampleDisplayProvider_Start(UnitySubsystemHandle handle)
{
    if (sXRStats)
    {
        sXRStats-&gt;RegisterStatSource(handle);
        m_GPUFrameTimeID = sXRStats-&gt;RegisterStatDefinition(handle, "Example.GPUTime", kUnityXRStatOptionNone);
        m_DroppedFrameCountID = sXRStats-&gt;RegisterStatDefinition(handle, "Example.DroppedFrame", kUnityXRStatOptionNone);
        m_WorkThreadStat = sXRStats-&gt;RegisterStatDefinition(handle, "Example.WorkerThreadStat", kUnityXRStatOptionNone);
    }

    return kUnitySubsystemErrorCodeSuccess;
}
</code></pre>

<p>Update stats on the Gfx Thread:</p>

<pre><code class="cpp">extern float GetLastGPUTime(); //provided by your runtime
static void ExampleDisplayProvider_GfxThreadCall(UnitySubsystemHandle handle)
{
    sXRStats-&gt;SetStatFloat(m_GPUFrameTimeID, GetLastGPUTime());
    // Do gfx thread things
}

</code></pre>

<p>Update stats on the main thread:</p>

<pre><code class="cpp">extern float GetDroppedFrameCount(); //provided by your runtime

static void ExampleDisplayProvider_MainThreadCall(UnitySubsystemHandle handle)
{
    sXRStats-&gt;SetStatFloat(m_DroppedFrameCountID, GetDroppedFrameCount());
    // Do main thread things
}
</code></pre>

<p>Update stats on your own threads, but be sure to call <code>IncrementStatFrame</code> to keep the current frame for that thread in sync with the other threads (this is managed internally for the main and graphics threads):</p>

<pre><code class="cpp">extern float GetWorkerThreadStat(); //provided by your runtime
static void ExampleDisplayProvider_MyWorkerThread(UnitySubsystemHandle handle)
{
    sXRStats-&gt;IncrementStatFrame();
    sXRStats-&gt;SetStatFloat(m_WorkThreadStat, GetWorkerThreadStat());
    // Do worker thread things
}
</code></pre>

<p>Unregister the stat source when the subsystem stops:</p>

<pre><code class="cpp">static void ExampleDisplayProvider_Stop(UnitySubsystemHandle handle)
{
    sXRStats-&gt;UnregisterStatSource(handle);
}

</code></pre>

<h2>Thread safety</h2>

<p>Updating stats via <code>SetStatFloat</code> is thread safe. However, registering and unregistering stat sources is not thread safe and should only be done on the main thread during the Start and Stop functions of the stat source’s lifecycle.</p>

<h2>限制</h2>

<p>The queue size for processing stats is 2000. This queue is shared amongst all threads and all subsystems and is only serviced upon frame completion. For this reason, you should keep the number of calls to <code>SetStatFloat</code> low to avoid filling up the queue.</p>

<p><strong>Note:</strong> Any stat recorded when the queue is full will be lost.</p>

<h2>Exposing stats to users</h2>

<p>In the <code>UnityEngine.XR.Provider</code> namespace, use <code>public static bool TryGetStat(Experimental.IntegratedSubsystem xrSubsystem, string tag, out float value)</code> to get stats registered and updated with your provider:</p>

<pre><code class="csharp">using UnityEngine.XR.Provider;
using System.Collections.Generic;
using UnityEngine.Experimental.XR;
using UnityEngine.Experimental;
using UnityEngine;

public static class ExampleProviderStats
{
    public static float GPUFrameTime()
    {
        float tmp;
        XRStats.TryGetStat(GetFirstDisplaySubsystem(), "Example.GPUTime", out tmp);
        return tmp;
    }

    public static int DroppedFrameCount()
    {
        float tmp;
        XRStats.TryGetStat(GetFirstDisplaySubsystem(), "Example.DroppedFrame", out tmp);
        return (int)tmp;
    }

    public static float MyWorkerThreadStat()
    {
        float tmp;
        XRStats.TryGetStat(GetFirstDisplaySubsystem(), "Example.WorkerThreadStat", out tmp);
        return tmp;
    }

    // etc...
    private static IntegratedSubsystem GetFirstDisplaySubsystem()
    {
        List&lt;XRDisplaySubsystem&gt; displays = new List&lt;XRDisplaySubsystem&gt;();
        SubsystemManager.GetInstances(displays);
        if (displays.Count == 0)
        {
            Debug.Log("No display subsystem found.");
            return null;
        }
        return displays[0];
    }
}
</code></pre>

<p>Writing public accessor methods such as the example above can help users acquire stats without the need to sift through provider documentation and find the subsystem with which stats are registered.</p>

<p>Additionally, some subsystems have predefined stat tags. Your provider can provide stats for the <a href="../ScriptReference/XR.XRStats.html">predefined stats APIs</a> that Unity exposes by registering subsystem specific stat tags (for example: <code>Headers/XR/UnityXRDisplayStats.h</code>).</p>
<!-- area:platforms -->
<div class="nextprev clear">
<div class="icon tt left mr1" data-distance="-40|-30|top">
<span class="prev"><a href="xrsdk-pre-init-interface.html"></a></span><div class="tip">XR SDK PreInit interface</div>
</div>
<div class="icon tt right" data-distance="-40|-30|top">
<span class="next"><a href="OpenSourceRepositories.html"></a></span><div class="tip">开源代码仓库</div>
</div>
</div>
</div>
<div class="footer-wrapper">
<div class="footer clear">
<div class="copy">Copyright © 2021 Unity Technologies. Publication 2020.3</div>
<div class="menu">
<a href="https://learn.unity.com/">教程</a><a href="https://answers.unity3d.com">社区答案</a><a href="https://support.unity3d.com/hc/en-us">知识库</a><a href="https://forum.unity3d.com">论坛</a><a href="https://unity3d.com/asset-store">Asset Store</a>
</div>
</div>
<div></div>
</div>
</div></div></div>
</div>
</body>
</html>
